package fr.urssaf.image.sae.exploitation.service;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.net.URL;
import java.util.Properties;

import org.apache.commons.lang.BooleanUtils;

import fr.urssaf.image.sae.exploitation.modele.ConfigurationDfce;

/**
 * Classe de manipulation
 * de la configuration Dfce.
 * 
 *
 */
public final class ConfigDfceService {

   /**
    * Protocole HTTPS
    */
   private static final String HTTPS = "https";
   
   /**
    * Protocole HTTP
    */
   private static final String HTTP = "http";
   
   
   /**
    * Constructeur privé, car uniquement des méthodes statiques
    */
   private ConfigDfceService() {
      assert false;
   }
   
   
   /**
    * Recupération de la representation technique du fichier de conf de DFCE
    * 
    * @param fileConfigDfce
    *                   fichier de conf DFCE
    * @return configurationDfce
    *                   representation technique du fichier
    * @throws IOException
    *                   exception
    */
   public static ConfigurationDfce getConfigDfce(File fileConfigDfce) throws IOException {
      
      FileInputStream fis = new FileInputStream(fileConfigDfce);
      try {


         Properties props = new Properties();
         props.load(fis);
         
         ConfigurationDfce config = new ConfigurationDfce(); 
         
         /*Pour Url savoir si nous sommes en HTTP ou HTTPS suivant le fichier de conf.*/
         String protocol = HTTP;
         boolean isSecure = BooleanUtils.toBoolean(props.getProperty("db.secure"));
         if (isSecure) {
            protocol = HTTPS;
         }
         
         URL url = new URL(protocol,
                           props.getProperty("db.hostName"), 
                           Integer.parseInt(props.getProperty("db.hostPort")),
                           props.getProperty("db.contextRoot")
                           ); 
         
         config.setDfceUrlTookit(url);
         
         config.setDfceLogin(props.getProperty("db.login"));
         
         config.setDfcePassword(props.getProperty("db.password"));
         
         config.setDfceBasename(props.getProperty("db.baseName"));
         
         return config;
         
         
      } finally {
         fis.close();
      }
      
   }
   
}
