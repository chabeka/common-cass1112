package fr.urssaf.image.sae.exploitation.service;

import static org.junit.Assert.fail;
import static org.junit.Assert.assertEquals;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;

import org.junit.Test;

import fr.urssaf.image.sae.exploitation.modele.ConfigurationDfce;

/**
 * Tests unitaires de la classe ConfigDfceService
 * 
 *
 */
@SuppressWarnings("PMD.LongVariable")
public class ConfigDfceServiceTest {

   
   /**
    * On vérifie que le service getConfigDfce renvoie une exception de type
    * FileNotFoundException si le chemin de fichier passé en paramètre pointe
    * vers un fichier inexistant
    * 
    * @throws FileNotFoundException
    * @throws IOException
    */
   @Test(expected = FileNotFoundException.class)
   public void isDfceUpFailureFileNotExists() throws FileNotFoundException, IOException {
      
      File file = new File("src/test/resources/exploitation/existepas.properties");
      
      ConfigDfceService.getConfigDfce(file);
      
      fail("Une exception de type FileNotFoundException aurait dû être levée");
      
   }
   
   
   /**
    * On vérifie que le fichier de configuration DFCE est correctement mappé
    * dans un objet ConfigurationDfce lorsque l'URL du toolkit doit être en HTTPS
    * 
    * @throws IOException
    */
   @Test
   public void configAvecHttps() throws IOException {
      
      File file = new File("src/test/resources/exploitation/sae-dfce-config-https.properties");
      
      ConfigurationDfce configDfce = ConfigDfceService.getConfigDfce(file);
      
      String urlToolkitActual = configDfce.getDfceUrlTookit().toString();
      String urlToolkitExpected = "https://leHostName:1234/dfce-webapp/toolkit/";
      assertEquals("L'URL du toolkit DFCE est incorrecte",urlToolkitExpected,urlToolkitActual);
      
      String loginActual = configDfce.getDfceLogin();
      String loginExpected = "leLogin";
      assertEquals("Le login est incorrect",loginExpected,loginActual);
      
      String passwordActual = configDfce.getDfcePassword();
      String passwordExpected = "lePassword";
      assertEquals("Le password est incorrect",passwordExpected,passwordActual);
      
      String baseNameActual = configDfce.getDfceBasename();
      String baseNameExpected = "leBaseName";
      assertEquals("Le nom de la base est incorrect",baseNameExpected,baseNameActual);
      
   }
   
}
