<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans	
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/jee
        http://www.springframework.org/schema/jee/spring-jee-3.0.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd 
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">

	<import resource="applicationContext-sae-vi.xml" />

	<!-- Gestion de message à partir d'un fichier properties -->
	<bean id="messageSource_sae_format"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="i18n.sae_format_messages" />
	</bean>

	<!-- Gestion de message à partir d'un fichier -->
	<bean id="messageSource_sae_mapping"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="i18n.sae_mapping_messages_fr_FR" />
	</bean>

	<bean
		class="fr.urssaf.image.sae.format.utils.message.SaeFormatMessageHandler">
		<constructor-arg ref="messageSource_sae_format" />
	</bean>

	<bean id="messageSource_sae_droits"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="i18n.sae_droits_messages" />
	</bean>

	<bean class="fr.urssaf.image.sae.droit.utils.ResourceMessagesUtils">
		<constructor-arg ref="messageSource_sae_droits" />
	</bean>

	<context:component-scan
		base-package="fr.urssaf.image.sae.ihm.web.exploit,fr.urssaf.image.sae.mapping.context" />

	<!-- PARTIE MVC A REVOIR -->
	<!-- =================== -->
	<!-- Mise en place de tout le mécanisme des contrôleurs comme le transtypage, 
		la validation -->
	<mvc:annotation-driven conversion-service="conversionService" />
	<mvc:view-controller path="/index.do" view-name="index" />

	<bean id="conversionService"
		class="fr.urssaf.image.sae.ihm.web.exploit.utils.ConversionDateFactoryBean" />


	<bean id="messageSource"
		class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>/message/label/labels</value>
				<value>/message/exception/exceptions</value>
				<!-- value>/message/exception/exceptionsExemple</value -->
				<value>/message/label/messages</value>
			</list>
		</property>
		<property name="cacheSeconds" value="-1" />
	</bean>


	<!-- ================================ -->
	<!-- CONFIGURATION DE L'APPLICATION -->
	<!-- ================================ -->

	<bean id="configurationGenerale" class="org.springframework.core.io.FileSystemResource">
		<constructor-arg>
			<jee:jndi-lookup id="SAE_IHM_WEB_EXPLOIT_CONFIG_GENERALE"
				jndi-name="java:comp/env/SAE_IHM_WEB_EXPLOIT_CONFIG_GENERALE" />
		</constructor-arg>
	</bean>

	<!-- Accès aux variables du fichier global de paramétrage -->
	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<array value-type="org.springframework.core.io.Resource">
				<ref bean="configurationGenerale" />
			</array>
		</property>
	</bean>

	<bean id="droitsService"
		class="fr.urssaf.image.sae.ihm.web.exploit.service.impl.DroitsServiceImpl" />
	<bean id="configurationService"
		class="fr.urssaf.image.sae.ihm.web.exploit.service.impl.ConfigurationServiceImpl" />
	<bean id="metadonneesService"
		class="fr.urssaf.image.sae.ihm.web.exploit.service.impl.MetadonneesServiceImpl" />
	<bean id="dictionaryService"
		class="fr.urssaf.image.sae.ihm.web.exploit.service.impl.DictionaryServiceImpl" />

	<!-- Bean permettant de charger les objets -->
	<bean id="configLoader" class="fr.urssaf.image.sae.ihm.web.exploit.loader.ConfigLoader">
		<constructor-arg ref="droitsService" />
		<constructor-arg ref="configurationService" />
		<constructor-arg ref="metadonneesService" />
		<constructor-arg ref="dictionaryService" />
	</bean>

	<!-- CONFIGURATION CASSANDRA ET SERVICES WEB -->
	<!-- _______________________________________ -->

	<!-- Fichier contenant la liste des configurations CASSANDRA et WS -->
	<bean id="environnementConfigFile" class="java.io.File">
		<constructor-arg value="${sae.ihm.web.exploit.cheminFichierConfiguration}" />
	</bean>

	<!-- CONFIGURATION DES FRONTAUX -->
	<bean id="environnementConfigFrontauxFile" class="java.io.File">
		<constructor-arg
			value="${sae.ihm.web.exploit.cheminFichierConfiguration-frontaux}" />
	</bean>

	<!-- Bean des ConfigurationsEnvironnement -->
	<bean id="configurationsEnvironnement" factory-bean="configLoader"
		factory-method="creerConfiguration">
		<constructor-arg ref="environnementConfigFile" />
	</bean>

	<!-- Bean des ConfigurationsEnvironnementFrontaux -->
	<bean id="configurationsEnvironnementFrontal" factory-bean="configLoader"
		factory-method="creerConfigurationFrontaux">
		<constructor-arg ref="environnementConfigFrontauxFile" />
	</bean>

	<!-- Bean configurationBean -->
	<bean id="configurationBean"
		class="fr.urssaf.image.sae.ihm.web.exploit.modele.ConfigurationBean">
		<constructor-arg value="${sae.ihm.web.exploit.version}" />
		<constructor-arg value="${sae.ihm.web.exploit.dureeSession}" />
		<constructor-arg value="${sae.ihm.web.exploit.maxKeysToRead}" />
		<constructor-arg value="${sae.metadata.cache}" />
		<constructor-arg value="${sae.metadata.initCacheOnStartup}" />
		<constructor-arg value="${sae.job.cache}" />
	</bean>

	<!-- CONFIGURATION DE LA LISTE DES DROITS -->
	<!-- ____________________________________ -->
	<!-- Fichier contenant la liste des droits -->
	<bean id="droitsConfigFile" class="java.io.File">
		<constructor-arg value="${sae.ihm.web.exploit.cheminFichierDroits}" />
	</bean>

	<bean id="listeDroits" factory-bean="configLoader" factory-method="creerDroits">
		<constructor-arg ref="droitsConfigFile" />
	</bean>


	<bean id="droitsFilter"
		class="fr.urssaf.image.sae.ihm.web.exploit.security.DroitsFilter" />

	<!-- Configure the multipart resolver -->
	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<!-- one of the properties available; the maximum file size in bytes -->
		<property name="maxUploadSize" value="1000000" />
	</bean>

</beans>