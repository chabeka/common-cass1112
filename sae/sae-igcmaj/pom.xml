<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

   <parent>
      <artifactId>sae</artifactId>
      <groupId>fr.urssaf.image.sae</groupId>
      <version>16.6.0.4-SNAPSHOT</version>
   </parent>

   <modelVersion>4.0.0</modelVersion>
   <groupId>fr.urssaf.image.sae</groupId>
   <artifactId>sae-igcmaj</artifactId>
   <name>sae-igcmaj</name>
   <version>16.6.0.4-SNAPSHOT</version>
   <description>Programme exécutable en mode console permettant le téléchargement des CRL.

Le programme est compatible Windows et Linux.

Il doit être accompagné d'un fichier de configuration, décrit dans les spécifications.

Le programme peut par exemple être exécuté sous forme de tâche planifiée, afin de conserver les CRL à jour.
</description>

   <dependencies>

      <!-- SAE IGC -->
      <dependency>
         <groupId>fr.urssaf.image.sae</groupId>
         <artifactId>sae-igc</artifactId>
         <version>16.6.0.4-SNAPSHOT</version>
      </dependency>

      <!-- Spring -->
      <dependency>
         <groupId>org.springframework</groupId>
         <artifactId>spring-beans</artifactId>
         <version>${spring.framework.version}</version>
      </dependency>
      <dependency>
         <groupId>org.springframework</groupId>
         <artifactId>spring-context</artifactId>
         <version>${spring.framework.version}</version>
      </dependency>
      <dependency>
         <groupId>org.springframework</groupId>
         <artifactId>spring-test</artifactId>
         <version>${spring.framework.version}</version>
         <scope>test</scope>
      </dependency>
   </dependencies>

   <build>

      <plugins>
         <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-shade-plugin</artifactId>
            <version>${maven-shade-plugin.version}</version>
            <executions>
               <execution>
                  <phase>package</phase>
                  <goals>
                     <goal>shade</goal>
                  </goals>
                  <configuration>
                     <artifactSet>
                        <excludes>
                           <exclude>commons-logging:commons-logging:jar:</exclude>
                           <exclude>log4j:log4j:jar:</exclude>
                        </excludes>
                     </artifactSet>
                     <filters>
                        <filter>
                           <artifact>*:*</artifact>
                           <excludes>
                              <exclude>META-INF/*.SF</exclude>
                              <exclude>META-INF/*.DSA</exclude>
                              <exclude>META-INF/*.RSA</exclude>
                           </excludes>
                        </filter>
                        <!--
                        Toutes les classes de org.aspectj:aspectjrt sont reprises
                        dans le jar org.aspectj:aspectjweaver
                        Néanmoins, il faut inclure les 2 jar dans les dépendances.
                        L'exclusion des classes se fait donc au niveau de Shade. 
                        -->
                        <filter>
                           <artifact>org.aspectj:aspectjrt</artifact>
                           <excludes>
                              <exclude>org/aspectj/**</exclude>
                           </excludes>
                        </filter>
                     </filters>
                     <transformers>
                        <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                           <mainClass>fr.urssaf.image.sae.igcmaj.IgcMain</mainClass>
                        </transformer>
                        <transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer">
                           <resource>META-INF/spring.handlers</resource>
                        </transformer>
                        <transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer">
                           <resource>META-INF/spring.schemas</resource>
                        </transformer>
                     </transformers>
                  </configuration>
               </execution>
            </executions>
         </plugin>

      </plugins>

   </build>


</project>