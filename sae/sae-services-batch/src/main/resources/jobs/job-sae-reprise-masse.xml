<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/batch"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">

   <job id="reprise_masse">
      <listeners>
         <listener ref="repriseMasseJobListener" />
      </listeners>
      <decision id="repriseMasseDecision" decider="repriseMasseDecider">
         <next on="REPRISE_MODIFICATION" to="repriseModificationMasse" />
         <next on="REPRISE_CAPTURE" to="repriseCaptureMasseInitialisation" />
         <next on="REPRISE_TRANSFERT" to="repriseTransfertMasse" />
         <next on="REPRISE_RESTORE" to="repriseRestoreMasse" />
         <next on="REPRISE_SUPPRESSION" to="repriseSuppressionMasse" />
      </decision>
      <step id="repriseModificationMasse">
         <job ref="modification_masse" job-launcher="jobLauncher" job-parameters-extractor="repriseMasseParametersExtractor" />
      </step>
      <step id="repriseCaptureMasse">
         <job ref="capture_masse" job-launcher="jobLauncher" job-parameters-extractor="repriseMasseParametersExtractor"/>
      </step>
      <step id="repriseTransfertMasse">
         <job ref="transfert_masse" job-launcher="jobLauncher" job-parameters-extractor="repriseMasseParametersExtractor"/>
      </step>
      <step id="repriseSuppressionMasse">
         <job ref="suppression_masse" job-launcher="jobLauncher" job-parameters-extractor="repriseMasseParametersExtractor"/>
      </step>
      <step id="repriseRestoreMasse">
         <job ref="restore_masse" job-launcher="jobLauncher" job-parameters-extractor="repriseMasseParametersExtractor"/>
      </step>

      <step id="repriseCaptureMasseInitialisation">
         <tasklet ref="repriseCaptureMasseInitTasklet">
            <listeners>
               <listener ref="repriseCaptureMasseInitListener" />
            </listeners>
         </tasklet>
         <next on="*" to="repriseCaptureMasse" />
         <next on="FAILED" to="finErreurReprise" />
      </step>
      
      <step id="finErreurReprise">
         <tasklet ref="resultatsFileRepriseFailureErrorTasklet">
            <listeners>
               <listener ref="resultatsFileFailureErrorListener" />
            </listeners>
         </tasklet>
         <fail on="*" exit-code="EARLY TERMINATION"/>
      </step>
   </job>

</beans:beans>
