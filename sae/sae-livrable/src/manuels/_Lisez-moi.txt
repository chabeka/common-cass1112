// --------------------------------------------------------------------
// Fichiers de configuration
// --------------------------------------------------------------------

Il faut substituer les tokens HAWAI suivants par leurs valeurs correspondantes : 

@@SAE_HOME@@
Chemin complet du répertoire "racine" de l'application SAE, dans lequel sont mis
les fichiers de configuration
Exemples :
   /hawai/data/sae
   c:/hawai/data/sae
   

@@DFCE_BASE_NAME@@
Le nom de la base DFCE.
Exemples :
  SAE-TEST
  SAE-GIVN


@@LOGS_PATH@@
Le chemin complet du répertoire dans lequel mettre les fichiers de logs du SAE.
Exemples :
  /hawai/logs/sae
  C:/hawai/logs/sae


@@SAE_CM_JAVA_OPTS@@
Les paramètres supplémentaires à fournir à la JVM dans laquelle s'exécute une capture de masse.
L'objectif est d'y mettre le paramétrage mémoire.
Par exemple, on peut mettre "-Xms500m -Xmx2500m" pour indiquer que la JVM démarre avec 500 Mo de RAM,
et peut monter jusqu'à 2.5 Go de RAM.
Le valeur du token doit être à vide à partir du lot 120510, dans lequel la capture de masse
a été optimisée et n'a plus besoin de cette configuration. 


@@SAE_PKIVALAED_CRL@@
L'URL du point de distribution des CRL de la PKI de validation AED.
La valeur par défaut doit être :
http://cer69idxpkival1.cer69.recouv/*.crl


@@SAE_PKIVALAED_ISSUER@@
Pour la PKI de validation AED, le pattern du CN de l'issuer du certificat de
signature du VI.
La valeur par défaut doit être :
CN=AC Applications


@@SAE_PKINAT_CRL@@
L'URL du point de distribution des CRL de la PKI nationale.
La valeur par défaut doit être :
http://pkipubcrl.cnp.recouv/*.crl
Sur une plateforme d'intégration/validation, on pourra par exemple se brancher
plutôt sur la PKI nationale de test.


@@SAE_PKINAT_ISSUER@@
Pour la PKI nationale, le pattern du CN de l'issuer du certificat de
signature du VI.
La valeur par défaut doit être :
CN=AC_APPLI_IGCN_RECOUV_2012
Sur une plateforme d'intégration/validation, on pourra par exemple mettre la 
valeur correspondant pour la PKI nationale de test




// --------------------------------------------------------------------
// Répertoires d'installation
// --------------------------------------------------------------------

Les fichiers suivants sont installés dans @@SAE_HOME@@/
  ecdesources.xml
  sae-cassandra-config.properties
  sae-config.properties
  sae-dfce-config.properties
  sae-igc-config.xml
  

Les répertoires suivants doivent être créés :
  @@SAE_HOME@@/certificats
  @@SAE_HOME@@/certificats/PKI_NAT
  @@SAE_HOME@@/certificats/PKI_NAT/ACRacine
  @@SAE_HOME@@/certificats/PKI_NAT/CRL
  @@SAE_HOME@@/certificats/PKI_VAL_AED
  @@SAE_HOME@@/certificats/PKI_VAL_AED/ACRacine
  @@SAE_HOME@@/certificats/PKI_VAL_AED/CRL
  @@SAE_HOME@@/dfce-migration/
  @@SAE_HOME@@/sae-dfce-admin-exploit/
  @@SAE_HOME@@/sae-igcmaj/
  @@SAE_HOME@@/sae-lotinstallmaj/
  @@SAE_HOME@@/sae-ordonnanceur/
  @@SAE_HOME@@/sae-services-executable/
  

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/certificats/PKI_NAT/ACRacine
  AC_RACINE_IGCN_RECOUV_2012.crt

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/certificats/PKI_VAL_AED/ACRacine
  pseudo_IGCA.crt

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/dfce-migration/
  dfce-migration-from-1.0.1-to-1.1.0.jar

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-dfce-admin-exploit/
  LifeCycleRule.xml
  logback-sae-dfce-admin-exploit.xml
  saeBase.xml
  sae-dfce-admin-exploit.jar
 
Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-igcmaj/
  sae-igcmaj-exe.jar
  
Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-lotinstallmaj/
  logback-sae-lotinstallmaj.xml
  sae-lotinstallmaj.jar

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-ordonnanceur/
 logback-sae-ordonnanceur.xml
 sae-ordonnanceur.jar
 sae-ordonnanceur.sh

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-services-executable/
  logback-sae-services-executable.xml
  sae-services-executable.jar

Les fichiers ci-dessous sont installés dans @@SAE_HOME@@/sae-trace-executable/
  logback-sae-trace-executable.xml
  sae-trace-executable.jar
 


// --------------------------------------------------------------------
// Commande de lancement de sae-igcmaj-exe.jar
// --------------------------------------------------------------------

java -jar @@SAE_HOME@@/sae-igcmaj/sae-igcmaj-exe.jar @@SAE_HOME@@/sae-igc-config.xml




// --------------------------------------------------------------------
// Commande de lancement de sae-services-executable.jar
// --------------------------------------------------------------------

Ce programme est lancé par l'ordonnanceur (sae-ordonnanceur.jar).

Le début de la ligne de commande pour l'appel à sae-services-executable.jar est
lu depuis le fichier de configuration général sae-config.properties, dans la clé
sae.archivagemasse.executable

L'ordonnanceur complète la ligne de commande avec les actions suivantes :
- remplace le marqueur _XMS_TO_REPLACE_ par la valeur par défaut 500m
- remplace le marqueur _XMX_TO_REPLACE_ par la valeur par défaut 500m
- remplace le marqueur _UUID_TO_REPLACE par l'identifiant unique du traitement de masse
- ajoute à la fin de la ligne de commande :
   traitementMasse [IdentifiantDuTraitementDeMasse] [CheminFichierConfigurationSAE]
  avec :
    [IdentifiantDuTraitementDeMasse] l'identifiant unique du traitement de masse
    [CheminFichierConfigurationSAE] le chemin complet du fichier de configuration général



// --------------------------------------------------------------------
// Commandes de lancement de sae-dfce-admin-exploit.jar
// --------------------------------------------------------------------

// Pour lancer la création de la base DFCE
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=createDataBase @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar createDataBase @@SAE_HOME@@/sae-config.properties @@SAE_HOME@@/sae-dfce-admin-exploit/saeBase.xml @@SAE_HOME@@/sae-dfce-admin-exploit/LifeCycleRule.xml

// Pour lancer la réindexation de la base DFCE
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=reindex @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar reindex @@SAE_HOME@@/sae-config.properties

// Pour lancer la création des journaux des événements
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=creatSystemEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar creatSystemEvent @@SAE_HOME@@/sae-config.properties

// Pour consulter le dernier journal des événements créé
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=consultSystemEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar consultSystemEvent @@SAE_HOME@@/sae-config.properties /tmp

// Pour lancer la purge des traces des événements
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=clearSystemEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar clearSystemEvent @@SAE_HOME@@/sae-config.properties 30

// Pour lancer la création des journaux du cycle de vie des archives
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=createDocEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar createDocEvent @@SAE_HOME@@/sae-config.properties

// Pour consulter le dernier journal du cycle de vie des archives créé
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=consultDocEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar consultDocEvent @@SAE_HOME@@/sae-config.properties /tmp

// Pour lancer la purge des traces du cycle de vie des archives
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=clearDocEvent @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar clearDocEvent @@SAE_HOME@@/sae-config.properties 30

// Pour lancer la mise à jour des durée de conservation des documents
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=updateLifecycleRules @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar updateLifecycleRules @@SAE_HOME@@/sae-config.properties @@SAE_HOME@@/sae-dfce-admin-exploit/LifeCycleRule.xml

// Pour lancer la réindexation des documents sur un ou plusieurs métadonnées (nb: utiliser les codes courts, séparer par des ;)
java -jar -Dlogback.configurationFile=@@SAE_HOME@@/sae-dfce-admin-exploit/logback-sae-dfce-admin-exploit.xml -Doperation=updateDocuments @@SAE_HOME@@/sae-dfce-admin-exploit/sae-dfce-admin-exploit.jar updateDocuments @@SAE_HOME@@/sae-config.properties meta1;meta2


// --------------------------------------------------------------------
// Commandes de lancement de sae-lotinstallmaj
// --------------------------------------------------------------------

// Installation du lot SAE-120510 - Pour rendre le code activité non obligatoire
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CODEACTIVITENONOBLIGATOIRE 

// Installation du lot SAE-120511 - Création de la base Cassandra "SAE"
// La base "SAE" contient la pile des travaux et la persistance d'état des travaux Spring Batch   
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_120510

// Installation du lot SAE-120512 - Mise à niveau de la base Cassandra "SAE" 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_120512

// Installation du lot SAE-120910 - Mise à niveau de la base Cassandra pour le Keyspace "SAE" 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_120910

// Création des nouvelles métadonnées pour la gestion des mandats SEPA
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties META_SEPA

// Installation du lot 130400SAE - Mise à niveau de la base Cassandra "SAE" 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_130400

// Installation du lot 130400SAE - Création des nouvelles métadonnées 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties META_130400

// Installation du lot 130700SAE - Mise à jour du Keyspace Docubase pour la version 1.2.x de DFCE 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties DFCE_130700

// Installation du lot 130700SAE - Mise à jour du Keyspace SAE, création des nouvelles métadonnées 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_130700

// Installation des droits GED 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CASSANDRA_DROITS_GED

// Installation de la GED 
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-lotinstallmaj/logback-sae-lotinstallmaj.xml -jar @@SAE_HOME@@/sae-lotinstallmaj/sae-lotinstallmaj.jar @@SAE_HOME@@/sae-config.properties CREATION_GED

// --------------------------------------------------------------------
// Commandes de lancement de sae-ordonnanceur
// --------------------------------------------------------------------

// Attention : l'ordonnanceur ne rend pas la main, et est censé être en permanance en cours d'exécution
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-ordonnanceur/logback-sae-ordonnanceur.xml -jar @@SAE_HOME@@/sae-ordonnanceur/sae-ordonnanceur.jar @@SAE_HOME@@/sae-config.properties 



// --------------------------------------------------------------------
// Commandes de lancement de sae-trace-executable
// --------------------------------------------------------------------

// Purge du registre de surveillance technique
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-trace-executable/logback-sae-trace-executable.xml -Doperation=PURGE_TECHNIQUE -jar @@SAE_HOME@@/sae-trace-executable/sae-trace-executable.jar @@SAE_HOME@@/sae-config.properties PURGE PURGE_TECHNIQUE

// Purge du registre d'exploitation
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-trace-executable/logback-sae-trace-executable.xml -Doperation=PURGE_EXPLOITATION -jar @@SAE_HOME@@/sae-trace-executable/sae-trace-executable.jar @@SAE_HOME@@/sae-config.properties PURGE PURGE_EXPLOITATION

// Purge du registre de sécurité
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-trace-executable/logback-sae-trace-executable.xml -Doperation=PURGE_SECURITE -jar @@SAE_HOME@@/sae-trace-executable/sae-trace-executable.jar @@SAE_HOME@@/sae-config.properties PURGE PURGE_SECURITE

// Production du journal SAE
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-trace-executable/logback-sae-trace-executable.xml -Doperation=JOURNALISATION_EVT -jar @@SAE_HOME@@/sae-trace-executable/sae-trace-executable.jar @@SAE_HOME@@/sae-config.properties JOURNALISATION JOURNALISATION_EVT

// Purge des traces SAE
java -Dlogback.configurationFile=@@SAE_HOME@@/sae-trace-executable/logback-sae-trace-executable.xml -Doperation=PURGE_EVT -jar @@SAE_HOME@@/sae-trace-executable/sae-trace-executable.jar @@SAE_HOME@@/sae-config.properties PURGE PURGE_EVT



// --------------------------------------------------------------------
// Les CRON à créer
// --------------------------------------------------------------------

- sur chaque serveur d'appli, un cron qui une fois par jour lance sae-igcmaj-exe.jar

- sur un seul des serveurs d'appli, tous CNP confondus, un cron qui une fois par jour lance, en parallèle :
    - sae-dfce-admin-exploit.jar reindex
    - sae-dfce-admin-exploit.jar creatSystemEvent
    - sae-dfce-admin-exploit.jar clearSystemEvent
    - sae-dfce-admin-exploit.jar creatDocEvent
    - sae-dfce-admin-exploit.jar clearDocEvent
    - sae-trace-executable.jar PURGE PURGE_TECHNIQUE
    - sae-trace-executable.jar PURGE PURGE_EXPLOITATION
    - sae-trace-executable.jar PURGE PURGE_SECURITE
    - sae-trace-executable.jar JOURNALISATION JOURNALISATION_EVT
    - sae-trace-executable.jar PURGE PURGE_EVT


