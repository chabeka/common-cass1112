/**
 *  TODO (AC75095028) Description du fichier
 */
package fr.urssaf.image.sae.trace.service.implcql;

import java.util.Optional;
import java.util.UUID;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.stereotype.Component;

import fr.urssaf.image.commons.cassandra.exception.CassandraConfigurationException;
import fr.urssaf.image.commons.cassandra.helper.CassandraCQLClientFactory;
import fr.urssaf.image.sae.trace.dao.modelcql.TraceRegExploitationCql;
import fr.urssaf.image.sae.trace.dao.modelcql.TraceRegExploitationIndexCql;
import fr.urssaf.image.sae.trace.dao.supportcql.GenericAbstractTraceCqlSupport;
import fr.urssaf.image.sae.trace.dao.supportcql.TraceRegExploitationCqlSupport;
import fr.urssaf.image.sae.trace.daocql.ITraceRegExploitationCqlDao;
import fr.urssaf.image.sae.trace.daocql.ITraceRegExploitationIndexCqlDao;
import fr.urssaf.image.sae.trace.daocql.impl.TraceRegExploitationCqlDaoImpl;
import fr.urssaf.image.sae.trace.daocql.impl.TraceRegExploitationIndexCqlDaoImpl;
import fr.urssaf.image.sae.trace.service.RegExploitationServiceCql;
import fr.urssaf.image.sae.trace.service.impl.RegExploitationServiceImpl;
import fr.urssaf.image.sae.trace.service.support.LoggerSupport;
import fr.urssaf.image.sae.trace.support.TimeUUIDEtTimestampSupport;

/**
 * TODO (AC75095028) Description du type
 */
@Component
public class RegExploitationCqlServiceImpl implements RegExploitationServiceCql {

  private final  TraceRegExploitationCqlSupport support;

  private final  LoggerSupport loggerSupport;

  private static final Logger LOGGER = LoggerFactory
      .getLogger(RegExploitationServiceImpl.class);

  /**
   * Constructeur
   *
   * @param support
   *           Support de la classe DAO TraceRegExploitationDao
   * @param clockSupport
   *           JobClockSupport Cassandra
   * @param loggerSupport
   *           Support pour l'Ã©criture des traces applicatives
   */
  @Autowired
  public RegExploitationCqlServiceImpl(final TraceRegExploitationCqlSupport support, final LoggerSupport loggerSupport) {
    super();
    this.support = support;
    this.loggerSupport = loggerSupport;
  }

  public RegExploitationCqlServiceImpl(final ApplicationContext context) {
    final CassandraCQLClientFactory ccf = (CassandraCQLClientFactory) context.getBean("cassandraCQLClientFactory");
    if (ccf == null) {
      throw new CassandraConfigurationException("CassandraCQLClientFactory est null !");
    }
    final ITraceRegExploitationCqlDao dao = new TraceRegExploitationCqlDaoImpl();
    // dao.setCcf(ccf); EC
    final ITraceRegExploitationIndexCqlDao indexDao = new TraceRegExploitationIndexCqlDaoImpl();
    // indexDao.setCcf(ccf); EC
    final TimeUUIDEtTimestampSupport timeUUIDSupport = new TimeUUIDEtTimestampSupport();
    final TraceRegExploitationCqlSupport support = new TraceRegExploitationCqlSupport(dao, indexDao, timeUUIDSupport);
    this.support = support;
    loggerSupport = new LoggerSupport();
  }

  /**
   * {@inheritDoc}
   */
  @Override
  public GenericAbstractTraceCqlSupport<TraceRegExploitationCql, TraceRegExploitationIndexCql> getSupport() {
    return support;
  }

  /**
   * {@inheritDoc}
   */
  @Override
  public LoggerSupport getLoggerSupport() {
    return loggerSupport;
  }


  /**
   * {@inheritDoc}
   */
  @Override
  public Logger getLogger() {
    return LOGGER;
  }

  @Override
  public TraceRegExploitationCql lecture(final UUID identifiant) {
    final Optional<TraceRegExploitationCql> traceOpt = support.find(identifiant);
    return traceOpt.orElse(null);
  }

}
