/**
 * 
 */
package fr.urssaf.image.sae.trace.dao.iterator;

import java.util.Date;
import java.util.Iterator;
import java.util.UUID;

import me.prettyprint.cassandra.service.ColumnSliceIterator;
import me.prettyprint.hector.api.beans.HColumn;
import me.prettyprint.hector.api.query.SliceQuery;

import org.apache.commons.lang.NotImplementedException;

import fr.urssaf.image.sae.trace.dao.model.TraceRegExploitationIndex;
import fr.urssaf.image.sae.trace.dao.serializer.TraceRegExploitationIndexSerializer;

/**
 * Itérateur sur les index des traces d'exploitation
 * 
 */
public class TraceRegExploitationIndexIterator implements
      Iterator<TraceRegExploitationIndex> {

   private final ColumnSliceIterator<Date, UUID, TraceRegExploitationIndex> sliceIterator;

   /**
    * Constructeur
    * 
    * @param sliceQuery
    *           La requête cassandra permettant de faire l'itération
    */
   public TraceRegExploitationIndexIterator(
         SliceQuery<Date, UUID, TraceRegExploitationIndex> sliceQuery) {
      sliceIterator = new ColumnSliceIterator<Date, UUID, TraceRegExploitationIndex>(
            sliceQuery, (UUID) null, (UUID) null, false);
   }

   /**
    * Constructeur
    * 
    * @param sliceQuery
    *           La requête cassandra permettant de faire l'itération
    * @param start
    *           TimeUUID de la première colonne
    * @param end
    *           TimeUUID de la dernière colonne
    */
   public TraceRegExploitationIndexIterator(
         SliceQuery<Date, UUID, TraceRegExploitationIndex> sliceQuery,
         UUID start, UUID end) {
      sliceIterator = new ColumnSliceIterator<Date, UUID, TraceRegExploitationIndex>(
            sliceQuery, start, end, false);
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public final boolean hasNext() {
      return sliceIterator.hasNext();
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public final TraceRegExploitationIndex next() {
      HColumn<UUID, TraceRegExploitationIndex> column = sliceIterator.next();
      return TraceRegExploitationIndexSerializer.get().fromByteBuffer(
            column.getValueBytes());
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public final void remove() {
      throw new NotImplementedException();

   }

}
