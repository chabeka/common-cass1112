package fr.urssaf.image.sae.ihm.web.exploit.service.impl;

import java.util.List;

import javax.servlet.http.HttpSession;

import net.docubase.toolkit.model.reference.CompositeIndex;

import fr.urssaf.image.commons.dfce.model.DFCEConnection;
import fr.urssaf.image.commons.dfce.service.DFCEConnectionService;
import fr.urssaf.image.commons.dfce.service.impl.DFCEConnectionServiceImpl;
import fr.urssaf.image.sae.ihm.web.exploit.service.IndexesCompositesService;
import fr.urssaf.image.sae.metadata.exceptions.IndexCompositeException;
import fr.urssaf.image.sae.metadata.referential.model.SaeIndexComposite;
import fr.urssaf.image.sae.metadata.referential.support.SaeIndexCompositeSupport;


public class IndexesCompositesServiceImpl implements IndexesCompositesService {
   
   
   SaeIndexCompositeSupport serviceSupport;
   
   /**
    * Constructeur par défaut
    */
   public IndexesCompositesServiceImpl() {}
   
   /**
    * Constructeur à partir de la session
    * 
    * @param session
    *           La session
    */
   public IndexesCompositesServiceImpl(HttpSession session){
      
      String nomConf = (String) session.getAttribute("nomConfiguration");

      DFCEConnection dfceConnection = (DFCEConnection)session
            .getServletContext().getAttribute(nomConf + "-dfce");
      
      // Instantiation du ServiceProviderSupportMetadata
      DFCEConnectionService dfceConnectionService = new DFCEConnectionServiceImpl(dfceConnection);
    
      serviceSupport = new SaeIndexCompositeSupport(dfceConnectionService);
   }
   
   /**
    * {@inheritDoc}
    */
   @Override
   public List<SaeIndexComposite> getAllCompositesIndexes() {
      return serviceSupport.getListeCompositeIndex();
   }
   
   /**
    * {@inheritDoc}
    * @throws IndexCompositeException 
    */
   @Override
   public CompositeIndex createCompositeIndex(List<String> codesCourts) throws IndexCompositeException {
      return serviceSupport.creatIndexComposite(codesCourts);
   }
}
