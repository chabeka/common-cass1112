package fr.urssaf.image.sae.ihm.web.exploit.security;

import java.io.IOException;
import java.util.List;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Classe permettant de gérer l'accès aux différentes ressources de
 * l'application
 * 
 * 
 */
public class DroitsFilter implements Filter {

   public final static int PAGE_ERREUR = 401;
   
   @Override
   public void destroy() {
      // TODO Auto-generated method stub

   }

   @SuppressWarnings("unchecked")
   @Override
   public final void doFilter(ServletRequest request, ServletResponse response,
         FilterChain chain) throws IOException, ServletException {

      HttpServletRequest httpReq = (HttpServletRequest) request;
      HttpServletResponse httpRes = (HttpServletResponse) response;

      String path = httpReq.getServletPath();

      HttpSession session = httpReq.getSession();
      List<String> pagmList = (List<String>) session.getAttribute("pagmList");
      boolean droitOk = false;
      if (pagmList != null) {
         for (String pagm : pagmList) {
            if ("ADMIN_TECHNIQUE".equals(pagm)) {
               if ("/rechercherDocuments.do".equals(path)
                     || "/afficherDocuments.do".equals(path)
                     || "/consulterDocument.do".equals(path)
                     || "/telecharger.do".equals(path)
                     || "/consulterPile.do".equals(path)
                     || "/lancerConsultDoc.do".equals(path)
                     || "/gererPile.do".equals(path)
                     || "/connexion.do".equals(path)) {
                  droitOk = true;
                  break;
               }
            }

            if ("CONSULT_TECHNIQUE".equals(pagm)) {
               if ("/rechercherDocuments.do".equals(path)
                     || "/afficherDocuments.do".equals(path)
                     || "/consulterDocument.do".equals(path)
                     || "/lancerConsultDoc.do".equals(path)
                     || "/telecharger.do".equals(path)
                     || "/consulterPile.do".equals(path)
                     || "/connexion.do".equals(path)) {
                  droitOk = true;
                  break;
               }
            }

            if ("CONSULT_ARCHIVE".equals(pagm)) {
               if ("/rechercherDocuments.do".equals(path)
                     || "/afficherDocuments.do".equals(path)
                     || "/consulterDocument.do".equals(path)
                     || "/lancerConsultDoc.do".equals(path)
                     || "/telecharger.do".equals(path)
                     || "/connexion.do".equals(path)) {
                  droitOk = true;
                  break;
               }
            }
         }
      }
      if (droitOk) {
         chain.doFilter(request, response);
      } else {
         httpRes.sendRedirect("droits.do");
         //httpRes.sendError(PAGE_ERREUR);

      }

   }

   @Override
   public void init(FilterConfig filterConfig) throws ServletException {
      // TODO Auto-generated method stub

   }

}
