package fr.urssaf.image.sae.ihm.web.exploit.service;

import java.io.IOException;
import java.util.List;
import java.util.UUID;

import fr.urssaf.image.commons.cassandra.helper.CassandraCQLClientFactory;
import fr.urssaf.image.commons.dfce.model.DFCEConnection;
import fr.urssaf.image.sae.ihm.web.exploit.exception.AucunDocumentException;
import fr.urssaf.image.sae.ihm.web.exploit.exception.ErreurTechniqueException;
import fr.urssaf.image.sae.ihm.web.exploit.modele.SaeDocument;
import fr.urssaf.image.sae.ihm.web.exploit.modele.SaeResultatRecherche;
import fr.urssaf.image.sae.metadata.exceptions.ReferentialException;
import fr.urssaf.image.sae.storage.exception.StorageException;
import me.prettyprint.hector.api.Keyspace;

/**
 * Ce service permet de realiser des opérations de recherche sur un ou plusieurs
 * document
 * 
 */
public interface RechercherService {

  /**
   * Renvoie la liste des documents satisfaisants à la requête lucène passée en
   * paramètre
   * 
   * @param requeteLucene
   *           Requête permettant de déterminer quels sont les documents à
   *           renvoyer
   * @param codes
   *           Liste des codes de métadonnées voulues à l'affichage
   * @param urlServiceWeb
   *           L'url du service WEB de la configuration choisie
   * @param login
   *           login de l'utilisateur (pour la traçabilité)
   * @return Informations sur les documents satisfaisant à la requête lucène
   * 
   * @throws ErreurTechniqueException
   *            Exception levée lorsqu'une erreur technique non prévue survient
   * @throws AucunDocumentException
   *            Exception levée lorsque la requête ne renvoie aucun document
   */
  SaeResultatRecherche rechercherDocuments(String requeteLucene,
                                           List<String> codes, String urlServiceWeb, String login)
                                               throws ErreurTechniqueException, AucunDocumentException;

  /**
   * Renvoie le document associé à l'uuid passé en paramètre
   * 
   * @param uuid
   *           Identifiant unique du document à chercher
   * @param codes
   *           Liste des codes de métadonnées voulues à l'affichage
   * @param urlServiceWeb
   *           l'url du service web de la configuration choisie
   * @param avecContenu
   *           indique si on récupère le contenu du document ou juste les
   *           métadonnées
   * @param login
   *           login de l'utilisateur (pour la traçabilité)
   * 
   * @return Document recherché
   * 
   * @throws ErreurTechniqueException
   *            Exception levée lorsqu'une erreur technique non prévue survient
   * @throws AucunDocumentException
   *            Exception levée lorsqu'aucun document n'est trouvé
   */
  SaeDocument consulterDocument(UUID uuid, List<String> codes,
                                String urlServiceWeb, boolean avecContenu, String login)
                                    throws ErreurTechniqueException, AucunDocumentException;

  /**
   * TODO
   * 
   * @param requeteLucene
   * @param codes
   * @param nbrRes
   * @param keyspace
   * @return
   * @throws ReferentialException
   * @throws StorageException
   * @throws IOException
   * @throws AucunDocumentException
   */
  SaeResultatRecherche getDocsFromRecycleBin(DFCEConnection dfceConnection,
                                             String requeteLucene,
                                             List<String> codes, int nbrRes, Keyspace keyspace)
                                                 throws ReferentialException,
                                                 StorageException, IOException, AucunDocumentException;


  /**
   * TODO
   * 
   * @param uuid
   * @param codes
   * @param avecContenu
   * @param dfceConnection
   * @param keyspace
   * @return
   * @throws AucunDocumentException
   * @throws ErreurTechniqueException
   */
  SaeDocument consultDocInRecycleBin(UUID uuid, List<String> codes,
                                     boolean avecContenu, DFCEConnection dfceConnection, Keyspace keyspace)
                                         throws AucunDocumentException,
                                         ErreurTechniqueException;

  void setCcf(final CassandraCQLClientFactory ccf);

}
