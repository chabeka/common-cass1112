package fr.urssaf.image.sae.ihm.web.exploit.decorateur;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import fr.urssaf.image.commons.maquette.definition.IMenu;
import fr.urssaf.image.commons.maquette.exception.MenuException;
import fr.urssaf.image.commons.maquette.tool.MenuItem;

/**
 * Classe gérant l'affichage des menus utilisateur
 * 
 * 
 */
public class IhmMenu implements IMenu {

  @Override
  public final String getBreadcrumb(final HttpServletRequest arg0) {

    if (arg0.getServletPath().equals("/authentification.do")
        || arg0.getServletPath().equals("/connexion.do")) {
      return "Accueil";
    }
    if (arg0.getServletPath().equals("/rechercherDocuments.do")) {
      return "Opérations SAE > Rechercher documents";
    }
    if (arg0.getServletPath().equals("/consulterDocument.do")) {
      return "Opérations SAE > Consulter document";
    }
    if (arg0.getServletPath().equals("/rechercherDocumentsEnCorbeille.do")) {
      return "Opérations SAE > Rechercher documents dans la corbeille";
    }
    if (arg0.getServletPath().equals("/consulterDocumentEnCorbeille.do")) {
      return "Opérations SAE > Consulter document de la corbeille";
    }

    if (arg0.getServletPath().equals("/comptageDocuments.do")) {
      return "Opérations SAE > Comptage documents";
    }
    if (arg0.getServletPath().equals("/consulterTraces.do")) {
      return "Traçabilité > Consulter les traces";
    }
    if (arg0.getServletPath().equals("/consulterJournaux.do")) {
      return "Traçabilité > Consulter les journaux";
    }
    if (arg0.getServletPath().equals("/consulterMetadonnes.do")) {
      return "Référentiels > Metadonnées > Consulter les métadonnées";
    }
    if (arg0.getServletPath().equals("/ajoutMetadonnees.do")) {
      return "Référentiels > Metadonnées > Ajout d'une métadonnée";
    }
    if (arg0.getServletPath().equals("/detailMeta.do")
        || arg0.getServletPath().equals("/gestionMeta.do")) {
      return "Référentiels > Metadonnées > Détails d'une métadonnée";
    }
    if (arg0.getServletPath().equals("/consulterDictionnaires.do")) {
      return "Référentiels > Metadonnées > Consulter les dictionnaires";
    }
    if (arg0.getServletPath().equals("/ajoutDictionnaire.do")) {
      return "Référentiels > Metadonnées > Ajout d'un dictionnaire";
    }
    if (arg0.getServletPath().equals("/detailDico.do")) {
      return "Référentiels > Metadonnées > Détails d'un dictionnaire";
    }
    if (arg0.getServletPath().equals("/consulterMetadonnes.do")) {
      return "Référentiels > Metadonnées > Consulter les métadonnées";
    }
    if (arg0.getServletPath().equals("/consulterFormats.do")) {
      return "Référentiels > Format > Consulter les formats";
    }
    if (arg0.getServletPath().equals("/ajoutFormat.do")) {
      return "Référentiels > Format > Ajout d'un format";
    }
    if (arg0.getServletPath().equals("/modifierFormat.do")
        || arg0.getServletPath().equals("/gestionFormats.do")) {
      return "Référentiels > Format > Modifier le format";
    }
    if (arg0.getServletPath().equals("/consulterIndexesComposites.do")) {
      return "Référentiels > Indexes Composites > Consultation";
    }
    if (arg0.getServletPath().equals("/ajouterIndexesComposites.do")) {
      return "Référentiels > Indexes Composites > Ajout d'un index composite";
    }
    if (arg0.getServletPath().equals("/gestionCS.do")) {
      return "Contrat de service > Gestion des contrats de service";
    }
    if (arg0.getServletPath().equals("/importCS.do")) {
      return "Contrat de service > Importer des contrats de service";
    }
    if (arg0.getServletPath().equals("/detailCS.do")) {
      return "Contrat de service > Détails d'un contrat de service";
    }

    return null;

  }

  @SuppressWarnings("unchecked")
  @Override
  public final List<MenuItem> getMenu(final HttpServletRequest arg0)
      throws MenuException {

    final List<MenuItem> listMenuItem = new ArrayList<>();
    final List<String> listePAGM = (List<String>) arg0.getSession().getAttribute(
        "pagmList");

    if (listePAGM != null) {

      // accueil
      final MenuItem miAccueil = new MenuItem();
      miAccueil.setTitle("Accueil");
      miAccueil.setLink("connexion.do");

      // Opération SAE
      final MenuItem miSAE = new MenuItem();
      miSAE.setTitle("Opérations SAE");

      // Recherche d'un document - rechercherDocuments
      final MenuItem miRechDoc = new MenuItem();
      miRechDoc.setLink("rechercherDocuments.do");
      miRechDoc.setTitle("Rechercher documents");

      // Consultation d'un document - consulterDocuments
      final MenuItem miConsultDoc = new MenuItem();
      miConsultDoc.setLink("consulterDocument.do");
      miConsultDoc.setTitle("Consulter documents");

      // Comptage des documents d'un traitement de masse
      final MenuItem miComptageDoc = new MenuItem();
      miComptageDoc.setLink("comptageDocuments.do");
      miComptageDoc.setTitle("Comptage documents");


      // Recherche d'un document - rechercherDocuments
      final MenuItem miRechDocCorbeille = new MenuItem();
      miRechDocCorbeille.setLink("rechercherDocumentsEnCorbeille.do");
      miRechDocCorbeille.setTitle("Rechercher documents dans la corbeille");

      // Consultation d'un document - consulterDocuments
      final MenuItem miConsultDocCorbeille = new MenuItem();
      miConsultDocCorbeille.setLink("consulterDocumentEnCorbeille.do");
      miConsultDocCorbeille.setTitle("Consulter documents de la corbeille");

      // Pile des travaux
      final MenuItem miPile = new MenuItem();
      miPile.setTitle("Pile des travaux");

      // Consulter la pile des travaux - visualiserPileTravaux
      final MenuItem miConsultPile = new MenuItem();
      miConsultPile.setLink("consulterPile.do");
      miConsultPile.setTitle("Consulter la pile");

      // Consulter la pile des travaux - visualiserPileTravaux
      final MenuItem miConsultPileByServer = new MenuItem();
      miConsultPileByServer.setLink("consulterPileParServeur.do");
      miConsultPileByServer.setTitle("Consulter la pile par serveur");

      // Gérer la pile des travaux - administrerPileTravaux
      final MenuItem miGererPile = new MenuItem();
      miGererPile.setLink("gererPile.do");
      miGererPile.setTitle("Gérer la pile");

      // Jobs
      final MenuItem miJobs = new MenuItem();
      miJobs.setTitle("Jobs");

      // Etat des jobs SAE
      final MenuItem miEtatJobsSAE = new MenuItem();
      miEtatJobsSAE.setLink("etatJobsSAE.do");
      miEtatJobsSAE.setTitle("Etat des jobs SAE");

      // Traces
      final MenuItem miTraces = new MenuItem();
      miTraces.setTitle("Traçabilité");
      // Consulter les traces - consulterTraces
      final MenuItem consultTraces = new MenuItem();
      consultTraces.setTitle("Consulter les traces");
      consultTraces.setLink("consulterTraces.do");
      // Consulter les journaux - consulterJournaux
      final MenuItem consultJournaux = new MenuItem();
      consultJournaux.setTitle("Consulter les journaux");
      consultJournaux.setLink("consulterJournaux.do");

      // Référentiels
      // Metadonnées
      final MenuItem miReferentiels = new MenuItem();
      miReferentiels.setTitle("Référentiels");

      final MenuItem miMeta = new MenuItem();
      miMeta.setTitle("Métadonnées");

      final MenuItem consultMeta = new MenuItem();
      consultMeta.setTitle("Consulter les métadonnées");
      consultMeta.setLink("consulterMetadonnees.do");

      final MenuItem ajouterMeta = new MenuItem();
      ajouterMeta.setTitle("Ajouter une métadonnée");
      ajouterMeta.setLink("ajoutMetadonnees.do");

      final MenuItem consulterDico = new MenuItem();
      consulterDico.setTitle("Consulter les dictionnaires");
      consulterDico.setLink("consulterDictionnaires.do");

      final MenuItem ajouterDico = new MenuItem();
      ajouterDico.setTitle("Ajouter un dictionnaire");
      ajouterDico.setLink("ajoutDictionnaire.do");


      // Indexes composites
      final MenuItem idxComposites = new MenuItem();
      idxComposites.setTitle("Indexes Composites");

      final MenuItem addIdxComposites = new MenuItem();
      addIdxComposites.setTitle("Ajouter un indexe composites");
      addIdxComposites.setLink("ajouterIndexesComposites.do");

      final MenuItem consultComposites = new MenuItem();
      consultComposites.setTitle("Consulter les indexes composites");
      consultComposites.setLink("consulterIndexesComposites.do");


      // Format
      final MenuItem miFormat = new MenuItem();
      miFormat.setTitle("Format");

      final MenuItem consultFormat = new MenuItem();
      consultFormat.setTitle("Consulter les formats");
      consultFormat.setLink("consulterFormats.do");

      final MenuItem ajouterFormat = new MenuItem();
      ajouterFormat.setTitle("Ajouter un format");
      ajouterFormat.setLink("ajoutFormat.do");

      // contrat de service

      final MenuItem miCS = new MenuItem();
      miCS.setTitle("CS");

      final MenuItem consultCs = new MenuItem();
      consultCs.setTitle("Consulter les CS");
      consultCs.setLink("consulterCs.do");

      final MenuItem importerCs = new MenuItem();
      importerCs.setTitle("Import de CS");
      importerCs.setLink("lancerImportCs.do");

      final MenuItem exporterCs = new MenuItem();
      exporterCs.setTitle("Export de CS");
      exporterCs.setLink("lancerExportCs.do");

      final MenuItem gestionCs = new MenuItem();
      gestionCs.setTitle("Gestion des CS");
      gestionCs.setLink("gestionCs.do");

      for (final String pagm : listePAGM) {

        // Récupération de la liste des actions unitaires associée

        if ("ADMIN_TECHNIQUE".equals(pagm)) {
          listMenuItem.add(miAccueil);

          listMenuItem.add(miSAE);
          miSAE.addChild(miRechDoc);
          miSAE.addChild(miConsultDoc);
          miSAE.addChild(miComptageDoc);
          miSAE.addChild(miRechDocCorbeille);
          miSAE.addChild(miConsultDocCorbeille);

          listMenuItem.add(miPile);
          miPile.addChild(miGererPile);
          miPile.addChild(miConsultPileByServer);

          listMenuItem.add(miJobs);
          miJobs.addChild(miEtatJobsSAE);

          listMenuItem.add(miTraces);
          miTraces.addChild(consultTraces);
          miTraces.addChild(consultJournaux);

          listMenuItem.add(miReferentiels);
          miReferentiels.addChild(miMeta);
          miMeta.addChild(consultMeta);
          miMeta.addChild(ajouterMeta);
          miMeta.addChild(consulterDico);
          miMeta.addChild(ajouterDico);
          miReferentiels.addChild(miFormat);
          miFormat.addChild(consultFormat);
          miFormat.addChild(ajouterFormat);

          miReferentiels.addChild(idxComposites);
          idxComposites.addChild(consultComposites);
          idxComposites.addChild(addIdxComposites);

          listMenuItem.add(miCS);
          miCS.addChild(consultCs);
          miCS.addChild(importerCs);
          miCS.addChild(exporterCs);
          miCS.addChild(gestionCs);

        }

        if ("CONSULT_TECHNIQUE".equals(pagm)) {
          listMenuItem.add(miAccueil);

          listMenuItem.add(miSAE);
          miSAE.addChild(miRechDoc);
          miSAE.addChild(miConsultDoc);
          miSAE.addChild(miComptageDoc);
          miSAE.addChild(miRechDocCorbeille);
          miSAE.addChild(miConsultDocCorbeille);

          listMenuItem.add(miPile);
          miPile.addChild(miConsultPile);
          miPile.addChild(miConsultPileByServer);
		  
		  listMenuItem.add(miTraces);
          miTraces.addChild(consultTraces);
          miTraces.addChild(consultJournaux);

        }

        if ("CONSULT_ARCHIVE".equals(pagm)) {
          listMenuItem.add(miAccueil);

          listMenuItem.add(miSAE);
          miSAE.addChild(miRechDoc);
          miSAE.addChild(miConsultDoc);
          miSAE.addChild(miRechDocCorbeille);
          miSAE.addChild(miConsultDocCorbeille);

		  listMenuItem.add(miReferentiels);
          miReferentiels.addChild(miMeta);
          miMeta.addChild(consultMeta);
          miMeta.addChild(consulterDico);
          miReferentiels.addChild(miFormat);
          miFormat.addChild(consultFormat);
          
          miReferentiels.addChild(idxComposites);
          idxComposites.addChild(consultComposites);
		  
		  listMenuItem.add(miCS);
          miCS.addChild(consultCs);

          
        }
      }
    }
    return listMenuItem;
  }

}
