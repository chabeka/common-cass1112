package fr.urssaf.image.sae.ihm.web.exploit.decorateur;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import fr.urssaf.image.commons.maquette.definition.IMenu;
import fr.urssaf.image.commons.maquette.exception.MenuException;
import fr.urssaf.image.commons.maquette.tool.MenuItem;

/**
 * Classe gérant l'affichage des menus utilisateur
 * 
 * 
 */
public class IhmMenu implements IMenu {

   @Override
   public final String getBreadcrumb(HttpServletRequest arg0) {

      if (arg0.getServletPath().equals("/authentification.do")
            || arg0.getServletPath().equals("/connexion.do")) {
         return "Accueil";
      }
      if (arg0.getServletPath().equals("/rechercherDocuments.do")) {
         return "Opérations SAE > Rechercher documents";
      }
      if (arg0.getServletPath().equals("/consulterDocument.do")) {
         return "Opérations SAE > Consulter document";
      }
      if (arg0.getServletPath().equals("/consulterTraces.do")) {
         return "Traçabilité > Consulter les traces";
      }
      if (arg0.getServletPath().equals("/consulterJournaux.do")) {
         return "Traçabilité > Consulter les journaux";
      }

      return null;

   }

   @SuppressWarnings("unchecked")
   @Override
   public final List<MenuItem> getMenu(HttpServletRequest arg0)
         throws MenuException {

      List<MenuItem> listMenuItem = new ArrayList<MenuItem>();
      List<String> listePAGM = (List<String>) arg0.getSession().getAttribute(
            "pagmList");

      if (listePAGM != null) {

         // accueil
         MenuItem miAccueil = new MenuItem();
         miAccueil.setTitle("Accueil");
         miAccueil.setLink("connexion.do");

         // Opération SAE
         MenuItem miSAE = new MenuItem();
         miSAE.setTitle("Opérations SAE");

         // Recherche d'un document - rechercherDocuments
         MenuItem miRechDoc = new MenuItem();
         miRechDoc.setLink("rechercherDocuments.do");
         miRechDoc.setTitle("Rechercher documents");

         // Consultation d'un document - consulterDocuments
         MenuItem miConsultDoc = new MenuItem();
         miConsultDoc.setLink("consulterDocument.do");
         miConsultDoc.setTitle("Consulter documents");

         // Pile des travaux
         MenuItem miPile = new MenuItem();
         miPile.setTitle("Pile des travaux");

         // Consulter la pile des travaux - visualiserPileTravaux
         MenuItem miConsultPile = new MenuItem();
         miConsultPile.setLink("consulterPile.do");
         miConsultPile.setTitle("Consulter la pile");

         // Gérer la pile des travaux - administrerPileTravaux
         MenuItem miGererPile = new MenuItem();
         miGererPile.setLink("gererPile.do");
         miGererPile.setTitle("Gérer la pile");
         
         // Traces
         MenuItem miTraces = new MenuItem();
         miTraces.setTitle("Traçabilité");
         // Consulter les traces - consulterTraces
         MenuItem consultTraces = new MenuItem();
         consultTraces.setTitle("Consulter les traces");
         consultTraces.setLink("consulterTraces.do");
         // Consulter les journaux - consulterJournaux
         MenuItem consultJournaux = new MenuItem();
         consultJournaux.setTitle("Consulter les journaux");
         consultJournaux.setLink("consulterJournaux.do");         

         for (String pagm : listePAGM) {

            // Récupération de la liste des actions unitaires associée

            if ("ADMIN_TECHNIQUE".equals(pagm)) {
               listMenuItem.add(miAccueil);
               
               listMenuItem.add(miSAE);
               miSAE.addChild(miRechDoc);
               miSAE.addChild(miConsultDoc);
               
               listMenuItem.add(miPile);
               miPile.addChild(miGererPile);
               
               listMenuItem.add(miTraces);
               miTraces.addChild(consultTraces);
               miTraces.addChild(consultJournaux);
               
            }

            if ("CONSULT_TECHNIQUE".equals(pagm)) {
               listMenuItem.add(miAccueil);
               
               listMenuItem.add(miSAE);
               miSAE.addChild(miRechDoc);
               miSAE.addChild(miConsultDoc);
               
               listMenuItem.add(miPile);
               miPile.addChild(miConsultPile);
            }

            if ("CONSULT_ARCHIVE".equals(pagm)) {
               listMenuItem.add(miAccueil);
               
               listMenuItem.add(miSAE);
               miSAE.addChild(miRechDoc);
               miSAE.addChild(miConsultDoc);
            }
         }
      }
      return listMenuItem;
   }

}
