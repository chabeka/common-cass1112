package fr.urssaf.image.sae.ihm.web.exploit.decorateur;

import java.awt.Menu;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import fr.urssaf.image.commons.maquette.definition.IMenu;
import fr.urssaf.image.commons.maquette.exception.MenuException;
import fr.urssaf.image.commons.maquette.tool.MenuItem;

/**
 * Classe gérant l'affichage des menus utilisateur
 * 
 * 
 */
public class IhmMenu implements IMenu {

   @Override
   public String getBreadcrumb(HttpServletRequest arg0) {

      if (arg0.getServletPath().equals("/authentification.do")) {

         return "Accueil";
      }

      return null;

   }

   @Override
   public List<MenuItem> getMenu(HttpServletRequest arg0) throws MenuException {

      List<MenuItem> listMenuItem = new ArrayList<MenuItem>();
      List<String> listePAGM = (List<String>) arg0.getSession().getAttribute(
            "pagmList");

      // accueil
      MenuItem miAccueil = new MenuItem();
      miAccueil.setTitle("Accueil");
      miAccueil.setLink("index.jsp");

      // Opération SAE
      MenuItem miSAE = new MenuItem();
      miSAE.setTitle("Opérations SAE");

      // Recherche d'un document - rechercherDocuments
      MenuItem miRechDoc = new MenuItem();
      miRechDoc.setLink("00_pagecomplete.html");
      miRechDoc.setTitle("Rechercher documents");

      // Consultation d'un document - consulterDocuments
      MenuItem miConsultDoc = new MenuItem();
      miConsultDoc = new MenuItem();
      miConsultDoc.setLink("01_pagesanshtmlniheadnibody.jsp");
      miConsultDoc.setTitle("Consulter documents");

      // Pile des travaux
      MenuItem miPile = new MenuItem();
      miPile.setTitle("Pile des travaux");

      // Consulter la pile des travaux - visualiserPileTravaux
      MenuItem miConsultPile = new MenuItem();
      miConsultPile = new MenuItem();
      miConsultPile.setLink("00_pagecomplete.html");
      miConsultPile.setTitle("Consulter la pile");

      // Gérer la pile des travaux - administrerPileTravaux
      MenuItem miGererPile = new MenuItem();
      miGererPile = new MenuItem();
      miGererPile.setLink("00_pagecomplete.html");
      miGererPile.setTitle("Gérer la pile");

      for (String pagm : listePAGM) {
         
         // Récupération de la liste des actions unitaires associée
         
         if (pagm.equals("ADMIN_TECHNIQUE")) {
            listMenuItem.add(miAccueil);
            listMenuItem.add(miSAE);
            miSAE.addChild(miRechDoc);
            miSAE.addChild(miConsultDoc);
            listMenuItem.add(miPile);
            miPile.addChild(miConsultPile);
            miPile.addChild(miGererPile);
         }

         if (pagm.equals("CONSULT_TECHNIQUE")) {
            listMenuItem.add(miAccueil);
            listMenuItem.add(miSAE);
            miSAE.addChild(miRechDoc);
            miSAE.addChild(miConsultDoc);
            listMenuItem.add(miPile);
            miPile.addChild(miConsultPile);            
         }

         if (pagm.equals("CONSULT_ARCHIVE")) {
            listMenuItem.add(miAccueil);
            listMenuItem.add(miSAE);
            miSAE.addChild(miRechDoc);
            miSAE.addChild(miConsultDoc);
         }
      }
      return listMenuItem;
   }

}
