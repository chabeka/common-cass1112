package fr.urssaf.image.sae.ihm.web.exploit.service.impl;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.text.MessageFormat;

import com.thoughtworks.xstream.XStream;
import com.thoughtworks.xstream.io.xml.StaxDriver;

import fr.urssaf.image.sae.ihm.web.exploit.modele.ConfigurationEnvironnement;
import fr.urssaf.image.sae.ihm.web.exploit.modele.ConfigurationsEnvironnement;
import fr.urssaf.image.sae.ihm.web.exploit.service.ConfigurationService;

/**
 * Classe implémentant le service ConfigurationService
 * 
 * 
 */
public class ConfigurationServiceImpl implements ConfigurationService {

   /**
    * Renvoie la liste de toutes les configurations des environnements
    * (CASSANDRA et services Web)
    * 
    * @param fichier
    *           Fichier contenant le liste des configurations environnement
    *           (CASSANDRA et services Web)
    * 
    * @return Liste de toutes les configurations environnement (CASSANDRA et
    *         services Web)
    * @throws FileNotFoundException Exception générée si le fichier n'existe pas
    * 
    */
   @Override
   public ConfigurationsEnvironnement chargerConfiguration(File fichier)
         throws FileNotFoundException {

      try {
         // Désérialisation des objets EcdeSource via Xstream
         StaxDriver staxDriver = new StaxDriver();
         XStream xstream = new XStream(staxDriver);
         xstream.alias("configuration", ConfigurationEnvironnement.class);
         xstream.alias("configurations", new ConfigurationEnvironnement[] {}
               .getClass());
         ConfigurationsEnvironnement confs = new ConfigurationsEnvironnement();
         confs.setConfigurations((ConfigurationEnvironnement[]) xstream
               .fromXML(new FileInputStream(fichier)));

         return confs;
      } catch (FileNotFoundException e) {
         throw new FileNotFoundException(MessageFormat.format(
               "Le fichier de configuration Cassandra et WS {0} n'existe pas",
               fichier.getAbsolutePath()));
      }
   }
}
