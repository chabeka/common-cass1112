package fr.urssaf.image.sae.ihm.web.exploit.factory;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import fr.urssaf.image.sae.droit.dao.model.Pagma;
import fr.urssaf.image.sae.droit.dao.model.Pagmp;
import fr.urssaf.image.sae.droit.dao.model.Prmd;
import fr.urssaf.image.sae.droit.dao.model.ServiceContract;
import fr.urssaf.image.sae.droit.model.SaePagm;
import fr.urssaf.image.sae.droit.model.SaePagma;
import fr.urssaf.image.sae.droit.model.SaePagmp;
import fr.urssaf.image.sae.droit.model.SaePrmd;
import fr.urssaf.image.sae.ihm.web.exploit.droit.CsType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.MetadonneeType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.PagmType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.PagmaType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.PagmpType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.ParametrePagmType;
import fr.urssaf.image.sae.ihm.web.exploit.droit.PrmdType;


/**
 * Factory d'objets
 */
public final class ObjectFactory {

   private ObjectFactory() {
      
   }
   
   
   /**
    * Création d'un objet de type Prmd à partir d'un objet de type PrmdType
    * @param prmdType l'objet de type PrmdType
    * @return l'objet de type Prmd
    */
   public static Prmd createPrmd(PrmdType prmdType) {
      
      Prmd prmd = new Prmd();
      
      prmd.setCode(prmdType.getCode());
      prmd.setDescription(prmdType.getDescription());
      prmd.setLucene(prmdType.getLucene());
      prmd.setBean(prmdType.getBean());
      
      prmd.setMetadata(createPrmdMetadatas(prmdType.getMetadonnees().getMetadonnee()));
      
      return prmd;
      
   }
   
   
   private static Map<String,List<String>> createPrmdMetadatas(List<MetadonneeType> listeMetaType) {
      
      Map<String,List<String>> metadonnees = new HashMap<String,List<String>>();
      
      String codeMeta;
      List<String> listeValeurs;
      for(MetadonneeType metadonnee: listeMetaType) {
         
         codeMeta = metadonnee.getCode();
         
         listeValeurs = new ArrayList<String>();
         for(String valeur: metadonnee.getValeurs().getValeur()) {
            listeValeurs.add(valeur);
         }
         
         metadonnees.put(codeMeta, listeValeurs);
         
      }
      
      return metadonnees;
      
   }
   
   
   /**
    * Création d'un objet de type ServiceContract à partir d'un objet de type CsType
    * @param csType l'objet de type CsType
    * @return l'objet de type ServiceContract
    */
   public static ServiceContract createCs(CsType csType) {
      
      ServiceContract serviceContract = new ServiceContract();
      
      serviceContract.setCodeClient(csType.getIssuer());
      serviceContract.setLibelle(csType.getCode());
      serviceContract.setDescription(csType.getDescription());
      serviceContract.setViDuree(csType.getViduree());
      serviceContract.setListPki(csType.getLstCnPki().getCnPki());
      serviceContract.setVerifNommage(csType.isVerifCnCert());
      serviceContract.setListCertifsClient(csType.getLstCnCert().getCnCert());

      return serviceContract;
      
   }
   
   
   /**
    * Création d'un objet de type SaePagm à partir d'un objet de type PagmType
    * @param pagmType l'objet de type PagmType
    * @return l'objet de type Pagm
    */
   public static SaePagm createPagm(PagmType pagmType) {
      
      Map<String,String> parametres = createParametres(pagmType);
      
      SaePagm saePagm = new SaePagm();
      
      saePagm.setCode(pagmType.getCode());
      saePagm.setDescription(pagmType.getDescription());
      PagmaType pagmaType = pagmType.getPagma();
      SaePagma pagma = new SaePagma();
      pagma.setActionUnitaires(pagmaType.getActions().getAction());
      pagma.setCode(pagmaType.getCode());
      PagmpType pagmpType = pagmType.getPagmp();
      SaePagmp pagmp = new SaePagmp();
      pagmp.setCode(pagmpType.getCode());
      pagmp.setDescription(pagmpType.getDescription());

      pagmp.setPrmd(pagmType.getPagmp().getPrmd());
      saePagm.setPagma(pagma);
      saePagm.setPagmp(pagmp);
      saePagm.setParametres(parametres);
      
      return saePagm;
      
   }
   
   
   private static Map<String,String> createParametres(PagmType pagmType) {
      
      Map<String,String> parametres = new HashMap<String,String>();
      
      for (ParametrePagmType paramPagm : pagmType.getParametres().getParametre()) {

         parametres.put(paramPagm.getCode(), paramPagm.getValeur());
         
      }
         
      return parametres;
      
   }
   
   
   /**
    * Création d'un objet de type Pagma à partir d'un objet de type PagmaType
    * @param pagmaType l'objet de type PagmaType
    * @return l'objet de type Pagm
    */
   public static Pagma createPagma(PagmaType pagmaType) {
      
      Pagma pagma = new Pagma();
      
      pagma.setCode(pagmaType.getCode());
      
      
      List<String> actionUnitaires = new ArrayList<String>();
      
      pagma.setActionUnitaires(actionUnitaires);
      
      for (String action: pagmaType.getActions().getAction()) {
         actionUnitaires.add(action);
      }
      
      return pagma;
      
   }
   
   /**
    * Création d'un objet de type Pagmp à partir d'un objet de type PagmpType
    * @param pagmpType l'objet de type PagmpType
    * @return l'objet de type Pagmp
    */
   public static Pagmp createPagmp(PagmpType pagmpType) {
      
      Pagmp pagmp = new Pagmp();
      
      pagmp.setCode(pagmpType.getCode());
      
      pagmp.setDescription(pagmpType.getDescription());
      
      pagmp.setPrmd(pagmpType.getPrmd());
      
      return pagmp;
      
   }
   
}
