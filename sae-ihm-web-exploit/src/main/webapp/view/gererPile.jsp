<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://displaytag.sf.net" prefix="display"%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>IHM Web Exploit - Gérer la pile des travaux</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="css/displaytag.css" rel="stylesheet" type="text/css" />
<link href="css/formulaire.css" rel="stylesheet" type="text/css" />

<script>

	//Afficher ou non la liste des colonnes pour personaliser l'affichage
	//à l'initialisation de l'écrané)
	function gererAffichageListeColonnes() {
		if (document.getElementById('modePerso').checked) {
			document.getElementById('colonnes').style.display = "inline";
		} else {
		   document.getElementById('colonnes').style.display = "none";
		}
	}
	
	// Afficher la liste des colonnes pour personaliser l'affichage
	// lorqu'on clique sur le mode personalisé
	// Décoche toutes les cases à cocher
	function afficherListeColonnes() {
	   document.getElementById('colonnes').style.display = "inline";
	   this.cocher('colonnes', false);   
	}
	
	// Cache la liste des colonnes pour personaliser l'affichage
	// lorqu'on clique sur minimal ou complet
	function cacherListeColonnes(){
		document.getElementById('colonnes').style.display = "none";
	} 
	
	// Afficher ou non la liste des critères de recherche
	function afficherListeCriteres() {
	   if (document.getElementById('criteresRecherche').style.display == "none") {
	      document.getElementById('criteresRecherche').style.display = "inline";
	   } else {
	      document.getElementById('criteresRecherche').style.display = "none";
	   }
	}
	
	// Cocher / Tous décocher (pour la liste des colonnes du mode personalisé)
	var isCoche = false;
	function GereChkbox(conteneur) {
	
	   	blnEtat = isCoche ? false : true;
		this.cocher(conteneur, blnEtat);
	   	isCoche = blnEtat;
	}
	function cocher(conteneur, aFaire) {
		var Chckbox = document.getElementById(conteneur).firstChild;
		while (Chckbox!=null) {
			if (Chckbox.nodeName=="INPUT")
				if (Chckbox.getAttribute("type")=="checkbox") {
					document.getElementById(Chckbox.getAttribute("id")).checked = aFaire;
				}
			Chckbox = Chckbox.nextSibling;
		}   
	}

	function getCheckedValue(radioObj) {
		if(!radioObj)
			return "";
		var radioLength = radioObj.length;
		if(radioLength == undefined)
			if(radioObj.checked)
				return radioObj.value;
			else
				return "";
		for(var i = 0; i < radioLength; i++) {
			if(radioObj[i].checked) {
				return radioObj[i].value;
			}
		}
		return "";
	}

	function confirmerSuppression() {
		var valeurSelectionnee = getCheckedValue(document.forms['formulaireGestion'].elements['identifiantATraiter']);
		if (valeurSelectionnee != "") {
			return confirm("Confirmer la suppression du document : " + valeurSelectionnee + "?");
		} else {
			alert("Merci de sélectionner un document");
			return false;
		}
	}
	function confirmerRelance() {
		var valeurSelectionnee = getCheckedValue(document.forms['formulaireGestion'].elements['identifiantATraiter']);
		if (valeurSelectionnee != "") {
			return confirm("Confirmer la relance du document : " + getCheckedValue(document.forms['formulaireGestion'].elements['identifiantATraiter']) + "?");
		} else {
			alert("Merci de sélectionner un document");
			return false;
		}
			
	}

	function changerLien() {
		
		if (document.getElementById("lienCriteres").innerHTML == "Afficher les critères de recherche ") {
			document.getElementById("lienCriteres").innerHTML = "Cacher les critères de recherche ";
		} else {
			document.getElementById("lienCriteres").innerHTML = "Afficher les critères de recherche ";
		}		
	}	
</script>

</head>

<body onload="gererAffichageListeColonnes();">

<form:form name="formulaireGestion" method="post" modelAttribute="gererPileTravauxForm">

	<h6 class="msg_erreur"><form:errors path='*' /></h6>

<div class="cadreForm">
		 Sélectionner le mode d'affichage :
		
		<form:radiobutton id="modeMin" path="modeAffichage" value="minimal" onclick="cacherListeColonnes();" />
		<label for="modeMin" class="inline">minimal</label>
		
		<form:radiobutton id="modeComplet" path="modeAffichage" value="complet" onclick="cacherListeColonnes();" />
		<label for="modeComplet" class="inline">complet</label>
		
		<form:radiobutton id="modePerso" path="modeAffichage" value="personnalise" onclick="afficherListeColonnes();" />
		<label for="modePerso" class="inline">personnalisé</label>
	
		<div id="colonnes">
			<br/><a href="javascript:GereChkbox('colonnes');">Cocher/Décocher</a><br />
			<c:forEach items="${colonnes}" var="colonne">
				<form:checkbox path="colonnesAffichees" value="${colonne}" label="${colonne}"/><br/>
			</c:forEach>
		</div>

	
	<!-- Critères de recherche -->
	
	
	<div style="padding-top: 10px"><a id="lienCriteres" href="javascript:afficherListeCriteres()" onclick="javascript:changerLien();">Afficher les critères de recherche </a> 

		<div id="criteresRecherche" style="display: none">
		<p class="double">
		<label for="dateCreationMin">Date de création minimale : </label>
		<form:input id="dateCreationMin" path="dateDebut" />
		</p>

		<p class="double">
		<label for="dateCreationMax">Date de création maximale : </label>
		<form:input id="dateCreationMax" path="dateFin"/>
		</p>
		
		<p class="double">
		<label for="type">Type : </label>
		<form:select id="type" path="type">
			<form:option value="TOUS" />
			<form:option value="capture_masse" />
			<form:option value="capture_unitaire" />
		</form:select>
		</p>

		<p class="double">		
		<label for="parametres">Paramètre : </label>
		<form:input id="parametres" path="parameters" />
		</p>

		<p class="double">
		<label for="etat">Etat : </label>
		<form:select id="etat" path="state">
			<form:option value="TOUS" />
			<form:option value="CREATED" />
			<form:option value="FAILURE" />
			<form:option value="STARTING" />
			<form:option value="SUCCESS" />
			<form:option value="RESERVED" />
		</form:select>
		</p>
		
		<p class="double">
		<label for="hostSae">Host SAE : </label>
		<form:input id="hostSae" path="saeHost" />
		</p>
		
		<p class="double">
		<label for="hostClient">Host Client : </label>
		<form:input id="hostClient" path="clientHost" />
		</p>
	</div>

</div>

	<p style="text-align: right">	<input type="submit" value="Filtrer" name="bouton_validation"/>
		<input type="submit" value="Rechercher" name="bouton_validation"/>
	</p>

</div>	

	<p>
		<input type="submit" value="Supprimer" name="bouton_validation" onclick="return confirmerSuppression()"/>
		<input type="submit" value="Relancer" name="bouton_validation" onclick="return confirmerRelance()"/>
	</p>


	<div style="overflow: scroll"><display:table
		name="listeJobAffiches" id="jobRow" requestURI="/gererPile.do"
		pagesize="30" style="width: 90%;">
		
		<display:column style="width: 5%" title="">
			<form:radiobutton id="identifiant" path="identifiantATraiter" value="${jobRow.idJob}" />
		</display:column>

		<display:column property="idJob" title="idJob" />
		<c:forEach items="${gererPileTravauxForm.colonnesAffichees}"
			var="colonne">
			<td><c:if test="${colonne == 'type'}">
				<display:column property="type" title="type" sortable="true" />
			</c:if> <c:if test="${colonne == 'parameters'}">
				<display:column property="parameters" title="parameters" />
			</c:if> <c:if test="${colonne == 'state'}">
				<display:column property="state" title="state" sortable="true" />
			</c:if> <c:if test="${colonne == 'creationDate'}">
				<display:column property="creationDate" title="creationDate"
					sortable="true" format="{0,date,dd/MM/yyyy HH:mm}" />
			</c:if> <c:if test="${colonne == 'saeHost'}">
				<display:column property="saeHost" title="saeHost" sortable="true" />
			</c:if> <c:if test="${colonne == 'clientHost'}">
				<display:column property="clientHost" title="clientHost"
					sortable="true" />
			</c:if> <c:if test="${colonne == 'docCount'}">
				<display:column property="docCount" title="docCount" />
			</c:if> <c:if test="${colonne == 'reservationDate'}">
				<display:column property="reservationDate" title="reservationDate"
					sortable="true" format="{0,date,dd/MM/yyyy HH:mm}"/>
			</c:if> <c:if test="${colonne == 'reservedBy'}">
				<display:column property="reservedBy" title="reservedBy"
					sortable="true" />
			</c:if> <c:if test="${colonne == 'startingDate'}">
				<display:column property="startingDate" title="startingDate"
					sortable="true" />
			</c:if> <c:if test="${colonne == 'pid'}">
				<display:column property="pid" title="pid" sortable="true" />
			</c:if> <c:if test="${colonne == 'endingDate'}">
				<display:column property="endingDate" title="endingDate"
					sortable="true" format="{0,date,dd/MM/yyyy HH:mm}"/>
			</c:if> <c:if test="${colonne == 'message'}">
				<display:column property="message" title="message" sortable="true" />
			</c:if> <c:if test="${colonne == 'toCheckFlag'}">
				<display:column property="toCheckFlag" title="toCheckFlag"
					sortable="true" />
			</c:if> <c:if test="${colonne == 'toCheckFlagRaison'}">
				<display:column property="toCheckFlagRaison"
					title="toCheckFlagRaison" sortable="true" />
			</c:if></td>
		</c:forEach>
	</display:table></div>

</form:form>

</body>
</html>


