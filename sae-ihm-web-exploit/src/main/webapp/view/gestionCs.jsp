<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://displaytag.sf.net" prefix="display"%>
<%@taglib prefix="custom" uri="/WEB-INF/tld/map.tld"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>IHM Web Exploit - Gestion des Contrat de service</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="css/displaytag.css" rel="stylesheet" type="text/css" />
<link href="css/formulaire.css" rel="stylesheet" type="text/css" />
<link href="css/calendrier.css" rel="stylesheet" media="screen"
	type="text/css" title="Design" />

<script type="text/javascript" src="js/calendrier.js"></script>
<script type="text/javascript">

   function submitForm(action) {

      if (action == 'modifier') {
         document.getElementById('modeLoad').value = 'modeLoad';
         document.forms[1].action = 'gestionCs.do?action=modifier';
         document.forms[1].submit();
         return true;
      } else if (action == 'ajouter') {
         document.getElementById('modeLoad').value = 'modeLoad';
         document.forms[1].action = 'gestionCs.do?action=ajouter';
         document.forms[1].submit();
         return true;
      }else if (action == 'charger') {
         document.getElementById('modeLoad').value = 'modeLoad';
         document.forms[0].action = 'gestionCs.do?action=charger';
         document.forms[0].submit();
         return true;
      }
   }
   
</script>


</head>

<body>

<form:form method="post" modelAttribute="csForm"
	enctype="multipart/form-data">


	<h6 class="msg_erreur" id="erreur"><form:errors path='*' /></h6>
	<h5><form:label id="message" path="message"><c:out value="${csForm.message}"></c:out></form:label></h5>
	
	<c:if test="${empty detailCs}">
		<table>
			<tr class="tableForm">
				<td colspan="3">
					<form:hidden path="modeCreation" id="modeLoad"/> 
					<label for="modeLoad">Création du CS à partir d'un fichier : </label>
				</td>
			</tr>
			<tr class="tableForm">
				<td class="tableFormGauche"><label>Sélectionner votre fichier : </label></td>
				<td><form:input id="file" type="file" path="file" cssClass="inputText"/></td>
				<td><input type="submit" value="charger" onclick="return submitForm('charger')" /></td>
			</tr>
		</table>
	</c:if>
</form:form>

<form:form id="cs" method="post" modelAttribute="csForm">
	<form:hidden id="droit" path="droit" />
	<form:hidden id="ajout" path="ajout" />
	<form:hidden id="store" path="store" />
    
	<c:if test="${not empty droitCs}">
		<p>Contrat de service :</p>
		<display:table name="droitCs" id="cs" style="width: 90%"
			defaultorder="ascending" pagesize="${nbLignesTableau}"
			requestURI="/gestionCs.do">
			<display:column title="Issuer" sortable="true">
				<c:out value="${cs.issuer}" />
			</display:column>
			<display:column title="Description" sortable="true">
				<c:out value="${cs.description}" />
			</display:column>
			<display:column title="Pagms">
				<c:set var="listePagms" value="${cs.pagms.pagm}"></c:set>
				<display:table style="width:100%" name="${listePagms}" id="pagm"  class="simple sublist">
					<display:column title="Code PAGM" sortable="true">
						<c:out value="${pagm.code}" />
					</display:column>
					<c:set var="listeActions" value="${pagm.pagma.actions}"></c:set>
					<display:column title="Actions">
						<display:table name="${listeActions}" id="actions">
							<display:column headerClass="none">
								<c:out value="${actions.action}" />
							</display:column>
						</display:table>
					</display:column>
					<c:set var="codePrmd" value="${pagm.pagmp.prmd}"></c:set>
					<display:column title="PRMD" sortable="true" >
						<c:out value="${codePrmd}" />
					</display:column>
				</display:table>
			</display:column>
		</display:table>
	</c:if>


	<c:if test="${not empty droitPrmd}">
		
		<p>PRMD :</p>
		<display:table name="droitPrmd" id="prmd" style="width: 90%"
			defaultorder="ascending" pagesize="${nbLignesTableau}"
			requestURI="/gestionCs.do">
			<display:column title="Code" sortable="true">
				<c:out value="${prmd.code}" />
			</display:column>
			<c:set var="listeMeta" value="${prmd.metadonnees.metadonnee}"></c:set>
			<display:column title="Metadonnées">
				<display:table name="${listeMeta}" id="meta">
					<display:column>
						<c:out value="${meta.code}" />
					</display:column>
				</display:table>
			</display:column>
			<display:column title="Lucene" sortable="true">
				<c:out value="${prmd.lucene}" />
			</display:column>
		</display:table>
	</c:if>


	<c:if test="${not empty droitPagm}">
		<p>Ajout de PAGM : </p>
		<display:table name="droitPagm" id="pagm" style="width: 90%"
			defaultorder="ascending" pagesize="${nbLignesTableau}"
			requestURI="/gestionCs.do">
			<display:column title="csIssuer" sortable="true">
				<c:out value="${pagm.csIssuer}" />
			</display:column>

			<display:column title="Pagms">
				<c:set var="listePagms" value="${pagm.pagms.pagm}"></c:set>
				<display:table name="${listePagms}" id="pagm">
					<display:column title="Code PAGM" sortable="true">
						<c:out value="${pagm.code}" />
					</display:column>
					<c:set var="listeActions" value="${pagm.pagma.actions}"></c:set>
					<display:column title="Actions">
						<display:table name="${listeActions}" id="actions">
							<display:column headerClass="none">
								<c:out value="${actions.action}" />
							</display:column>
						</display:table>
					</display:column>
					<c:set var="codePrmd" value="${pagm.pagmp.prmd}"></c:set>
					<display:column title="PRMD" sortable="true">
						<c:out value="${codePrmd}" />
					</display:column>
				</display:table>
			</display:column>
		</display:table>
	</c:if>


	<c:if test="${not empty detailCs}">
		<p><a href="javascript:window.history.go(-1)">[ Retour ]</a></p>
		<p>Contrat de service :</p>
		<display:table name="detailCs" id="cs" style="width: 90%"
			defaultorder="ascending" pagesize="${nbLignesTableau}"
			requestURI="/gestionCs.do">
			<display:column title="Issuer" sortable="true">
				<c:out value="${cs.codeClient}" />
			</display:column>
			<display:column title="Description" sortable="true">
				<c:out value="${cs.description}" />
			</display:column>
			<display:column title="Pagms">
				<c:set var="listePagms" value="${cs.pagms}"></c:set>
				<display:table name="${listePagms}" id="pagm" style="width:100%">
					<display:column title="Code PAGM" sortable="true">
						<c:out value="${pagm.code}" />
					</display:column>
					<c:set var="listeActions" value="${cs.pagmas}"></c:set>
					<display:column title="Actions">
						<display:table name="${listeActions}" id="actions" style="width:100%">
							<display:column headerClass="none">
								<c:out value="${actions.actionUnitaires}" />
							</display:column>
						</display:table>
					</display:column>
					<c:set var="prmds" value="${cs.prmds}"></c:set>
					<display:column title="PRMD" sortable="true">
						<display:table name="${prmds}" id="prmd" style="width:100%">
							<display:column headerClass="none">
								<c:out value="${prmd.code}" />
							</display:column>
						</display:table>
					</display:column>
				</display:table>
			</display:column>
		</display:table>

		<p>PRMD : </p>
		<c:set var="prmds" value="${cs.prmds}"></c:set>
		<display:table name="${prmds}" id="prmd" style="width:90%">
			<display:column title="Code PRMD">
				<c:out value="${prmd.code}" />
			</display:column>
			<display:column title="Métadonnées">
						<c:forEach items="${prmd.metadata}" var="meta">
							<c:out value="${meta.key}: ${meta.value}" />
						</c:forEach>
			</display:column>

			<display:column title="Requête Lucene">
				<c:out value="${prmd.lucene}" />
			</display:column>
		</display:table>
	</c:if>


	<c:if test="${csForm.modification=='true'}">
		<p style="text-align: right"><input style="display: none"
			id="bouttonModifier" type="submit" onclick="submitForm('modifier')"
			value="Modifier" /></p>
	</c:if>
	<c:if test="${csForm.ajout =='true'}">
		<p style="text-align: right"><input type="submit"
			onclick="return submitForm('ajouter')" value="Ajouter" /></p>
	</c:if>
</form:form>


</body>
</html>


