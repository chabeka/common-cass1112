<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://displaytag.sf.net" prefix="display"%>
<%@ taglib prefix="custom" uri="/WEB-INF/tld/map.tld"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<title>IHM Web Exploit - Ajout/Modification d'une métadonnée</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<link href="css/displaytag.css" rel="stylesheet" type="text/css" />
	<link href="css/formulaire.css" rel="stylesheet" type="text/css" />
	<link href="js/chosen/chosen.css" rel="stylesheet" />
	
	<script src="js/jquery.min.js" type="text/javascript"></script>
  	<script src="js/chosen/chosen.jquery.js" type="text/javascript"></script>
  	<script src="js/chosen/chosen.order.jquery.min.js"></script>
  	<script>jQuery.noConflict();</script>
	<script type="text/javascript">
		//-- On utilise jQuery.noConflict pour éviter la collision 
		// avec mootools utilisée pour l'affichage du menu
		jQuery(function($){
   			$(".chosen-select").chosen({
      			width: "90%",
      			no_results_text: "Aucun résultat !"
         	});

   			//-- Initialisation du formulaire
   			$("#messageBox").hide();
   			$("#formContent").hide();
   	   		$("#indexCategories").val("");
			
   	   		if($("#submitMessage").val() !== ""){
				$("#messageBox").text($("#submitMessage").val());
   	   		   	$("#messageBox").fadeIn(500, function(){
 	   		   		$("#formContent").delay(5000).fadeIn(500, function(){
   		   		  		$("#messageBox").hide();
   	      	   		});
      	   		});
      	   	}else{
      	   	   $("#formContent").show();
      	   	}
   	   	
		   	$(".chosen-select").on('change', function(evt, params) {

   	   			$("#indexCode").text("--");
			    var selection = $(".chosen-select").getSelectionOrder();
			    
				if(selection){
					var indexes = selection.join('&')+'&';
		      		//-- Affichage dynamique
			      	$("#indexCode").text(indexes);
			      	//-- Donnée à envoyer
	      			$("#indexCategories").val(indexes);
				}
			});

			$("#submitCreateIndex").click(function(){
			   	if($(".chosen-select").val()){
					if($(".chosen-select").val().length >= 2)
				   		return true;
					else{
				   		alert("Il faut au moins deux métas pour créer un index composite.");
						return false;
					}
			   	} else {
			   		alert("Veuillez sélectionner au moins deux métas.");
					return false;
			   	}
			});

				
		});
	</script>
</head>

<body>
	<form:form method="post" modelAttribute="indexesCompositesAjoutForm" action="ajouterIndexesComposites.do">
		<div class="cadreForm" style="margin: 20px;">
			<h2>Ajouter un index composite</h2>
			<p id="messageBox"></p>
			<div id="formContent">
				<select data-placeholder="Cliquez pour choisir les métas..." multiple class="chosen-select" tabindex="2">
					<option value=""></option>
					<c:forEach var="meta" items="${listeMetas}">
				        <option value="${meta.shortCode}">${meta.longCode}</option>
				   	</c:forEach>
				</select>
				<p>
					<b>Code de l'index à créer : </b>
					<code id="indexCode" style="padding:4px; background:#FFF; color: blue;">--</code>
					<form:hidden id="indexCategories" path="categories" />
					<form:hidden id="submitMessage" path="message" />
				</p>
				<p><input class="pad-5" id="submitCreateIndex" type="submit" value="Créer l'index composite" /></p>
			</div>
	   	</div>
	</form:form>

</body>
</html>


