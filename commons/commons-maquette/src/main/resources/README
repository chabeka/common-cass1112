Maquette Cirtil.technocom

date : 21/04/2010
version : 0.11
technologie : JavaEE 6
nom du projet : ImageMaquette
d�pendance : jericho-html-3.1.jar

Utilisation :
Copier les 2 jars (ImageMaquette et jericho-html-3.1) dans le r�pertoire WebContent/WEB-INF/lib/ de votre 
application web
ou bien 
Utiliser Maven avec la gestion des d�pendances

Note d'implémentation :
La maquette fonctionne comme un filtre de servlet. La maquette est donc appelée par le serveur d'application avant
l'appel au controller. C'est ensuite la maquette qui va faire un pré-traitment, appeler le controller via la méthode
doChain puis récupérer la main et faire un post traitement.
Il faut évidemment que le filtre soit activé dans le web.xml pour que le serveur d'application en tienne compte.

La maquette est composée d'élément Html, CSS, Javascript (menu) et Java.
Au niveau du Java, on va générer les boîtes de gauche et le menu via les interfaces ILeftCol et IMenu.
Java va également générer certaines CSS dont les paramètres se trouvent dans le web.xml.

Au niveau du javascript, les scripts sont inclus au moyen de la servlet getResourceImageMaquette.do, et ils permettent
de transformer la liste html ul/li en composant navigable au clavie ret à la souris.

Au niveau CSS on dispose de 9 scripts :
	default_html4_styles est chargé de définir les styles de base pour contrer toutes les css importées par les pages
	à décorer et dont le but est de reseter les styles de base. On redéfinit donc les styles des balises html standard
	tel que h1, pre, div... en précisant une classe frUrssafImageMaquette. Cela permet à la maquette de préserver son
	aspect. En plus, on redéfini les styles pour ces même balises html, mais sans la classe frUrssafImageMaquette, mais
	en précisant le chemin d'acès à la balise : 
		#container.frUrssafImageCommonsMaquette > #content.frUrssafImageCommonsMaquette > * address
	Cela permet de préciser le style souhaité pour les éléments à décorer et se trouvant donc dans la zone de contenu.
	En partant du principe qu'en css l'ordre de priorité est donné à la css dont le chemin est le plus long, nos styles
	seront donc prioritaires. Même si notre script est inclus avant les autres.
	Toutefois, on ne redéfinis pas tous les attributs (couleur notamment) et dans ce cas on pourrait perdre la main. 
	Si le problème est rencontré, il faudra enrichir ce script.
	
	on distingue ensuite les scripts main et menu. Les premiers sont chargés de définir les styles de la maquette alors
	que les seconds sont uniquement destinés au style du menu. Ces scripts sont déclinés en quatre fichiers :
		xxx.css : chargé principalement du positionnement
		xxx-color.css : chargé des couleurs
		xxx-font.css : chargé des polices (type, décoration, taille)
		xxx-font-color.css : chargé des couleurs des polices
		
Au niveau du html, tout est basé sur le script main.html qui contient la structure complète de la page web.


Knowns Bugs :

Workaround :

Todo :

Evolution r�alis�e :
v0.11
suppression du contenu de la balise title du main.html
prise en compte des nullPointerException sur l'utilisation des impl�mentations de ILeftCol et IMenu
modification du pom.xml pour le groupId de log4j et jericho
IMenu.getMenuItem devient IMenu.getMenu
passage de la request et non plus seulement de la session 
changement du nom du package fr.urssaf.image.commons.maquette et du finalName dans le pom.xml : artifactId-version
v0.10
Arborescence MAVEN
Fil d'ariane bas� sur l'url (on ne tient pas compte de la queryString)
nouveau param�tre : theme, qui permet de charger un th�me AED phase 1 ou GED phase 1. Les valeurs
possibles sont aed/ged. S'il est renseign�, les param�tres de CSS ne sont plus pris en compte.  
Suppression des images par d�faut (logo image et logo application)
v0.9
menu par d�faut supprim�
introduction des interfaces IMenu, IMenuItem et du param�tre du fichier web.xml implementationIMenu
impl�mentation du menu
v0.8
impl�mentation de la colonne de gauche
suppression de JsPartConfig car inutilis�, trop de fonctionnalit� tue l'application ...
mise en protected des setters des xxConfig dont la valeur est d�fini dans le web.xml
v0.7
hauteur minimum du header : r�utilisation d'une image pour IE6 car il ne g�re pas le min-height/max-height
introduction de l'interface ILeftCol et du param�tre du fichier web.xml implementationILeftCol
ajout du param�tre du fichier web.xml implementationIMenu
ajout des param�tres suivant dans le fichier web.xml : cssMenuFirstRowFontColor, cssMenuLinkFontColor, 
cssMenuLinkHoverFontColor
v0.6
suppression de la d�coration des txt : retrait de la ligne <url-pattern>*.txt</url-pattern> dans le filter-mapping
du fichier web.xml
getResourceImageMaquette devient getResourceImageMaquette.do afin de passer syst�matiquement dans le filtre de pouvoir
r�cup�rer les param�tres du web.xml
ajout de nouveau param�tre de filtre afin de personnaliser le th�me graphique
suppression des �l�ments par d�fauts de la colonne de gauche
hauteur du logo de l'application fix� � 50px si le client utilise IE6 
liser� bleu en haut � droite supprim� sous IE6
le padding de 2px en haut du header est supprim�
v0.5
resources externes : impl�mentation du workaround propos� en v0.4, c'est � dire que l'on ne filtre que les resources
connues via le web.xml et les noeuds url-pattern de la section filter-mapping (cf. le web.xml plus haut). On n'a donc 
plus besoin des param�tres de filtre includeFiles (supprim� du web.xml)
aucun contr�le n'est fait sur la taille du logo, toutefois, via les css on a limit� la hauteur de l'image entre 47 et
57px
l'erreur 404 n'est plus pr�sente, mais aucun moyen de savoir pourquoi elle �tait l�, ni ce qui a entra�n� sa disparion
l'exclusion de fichier pr�cis fonctionne si on fait attention � pr�ciser le r�pertoire complet :
	/TestMaquette/index.jsp, et non pas /index.jsp
v0.4
les param�tres du filtre includeFiles et excludeFiles sont g�r�s comme des pattern-uri et non plus avec des regexp
suppression du fil blanc en bas de page quand le logo de l'application fait moins de 47px
la balise head de la source html de l'application m�tier est int�gr� dans le template, � la fin du head
la balise title du template est supprim�e s'il y en a une dans le source de l'application m�tier 
le titre de l'application par d�faut est supprim� : si rien n'est sp�cifi� le titre dans le header sera vierge
v0.3
param�tre includeFiles pris en compte
v0.2
le ? au d�but
les javascripts inclus
le texte null
l'encodage des caract�res, forc� � ISO-8859-15
changement du nom du package
d�tection automatique de l'appel au getResourceImageMaquette

TODO :
envisager dans le filtre le fait de v�rifier le type mime du contenu retourn� par la requ�te : si le contenu est 
du html, alors on lance le d�corateur (sauf s'il est dans la liste des excludes)			   sinon (text/javascript,
plain, css, ...) on stop le d�corateur
Tester le fonctionnement du type mime sur des images g�n�r�es n'importe comment, sur les images g�n�r�s via le getResource
sur le html sans doctype, sans body... sur du javascript dans un txt... : c'est fait, le conteneur web se base sur 
l'extension du fichier demand� pour d�terminer le type mime. Par contre est il capable de d�terminer le type mime sans
cette extension ?