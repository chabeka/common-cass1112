<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/batch"
   xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="
         http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/batch
         http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">


   <job id="job7">
      <step id="XMLtoDoubleFile">
         <tasklet>
            <chunk reader="xmlReader" writer="compositeWriter"
               processor="conversionToFileProcessor" commit-interval="1"/>
         </tasklet>
      </step>
   </job>

   <beans:bean id="compositeWriter"
      class="org.springframework.batch.item.support.CompositeItemWriter">
      <beans:property name="delegates">
         <beans:list>
            <beans:ref bean="fileWriter" />
            <beans:ref bean="otherFileWriter" />
         </beans:list>
      </beans:property>
   </beans:bean>

   <beans:bean id="otherFileWriter" scope="step"
      class="org.springframework.batch.item.file.FlatFileItemWriter">
      <beans:property name="resource"
         value="file:#{jobParameters['other.file.output.location']}" />
      <beans:property name="lineAggregator">
         <beans:bean
            class="org.springframework.batch.item.file.transform.DelimitedLineAggregator">
            <beans:property name="delimiter" value="," />
            <beans:property name="fieldExtractor">
               <beans:bean
                  class="org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor">
                  <beans:property name="names"
                     value="identifiant,titre,auteur" />
               </beans:bean>
            </beans:property>
         </beans:bean>
      </beans:property>
   </beans:bean>

</beans:beans>
