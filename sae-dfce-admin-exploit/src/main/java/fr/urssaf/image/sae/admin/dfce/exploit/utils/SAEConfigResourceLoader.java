package fr.urssaf.image.sae.admin.dfce.exploit.utils;

import java.io.IOException;
import java.util.Properties;

import org.springframework.beans.factory.InitializingBean;
import org.springframework.core.io.FileSystemResource;
import org.springframework.core.io.Resource;
import org.springframework.util.Assert;

/**
 * Classe de chargement des propriétés du fichier de configuration générale du
 * SAE
 * 
 * 
 */
public class SAEConfigResourceLoader implements InitializingBean {

   private static final String DFCE_CONFIG = "sae.dfce.cheminFichierConfig";

   private final Properties saeProperties;

   /**
    * Chargement du fichier de configuration du SAE
    * 
    * @param saeConfigResource
    *           fichier de configuration du SAE
    * @throws IOException
    *            exception levée lors du chargement du fichier de configuration
    */
   public SAEConfigResourceLoader(Resource saeConfigResource)
         throws IOException {

      Assert.notNull(saeConfigResource, "'saeConfigResource' is required");

      saeProperties = new Properties();
      saeProperties.load(saeConfigResource.getInputStream());
   }

   /**
    * Le fichier de configuration doit contenir les propriétés :
    * <ul>
    * <li><code>sae.dfce.cheminFichierConfig</code></li>
    * </ul>
    */
   @Override
   public final void afterPropertiesSet() {

      Assert.isTrue(saeProperties.containsKey(DFCE_CONFIG),
            "le fichier de configuration du SAE doit contenir la propriété "
                  + DFCE_CONFIG);

   }

   /**
    * Retourne le fichier de configuration de DFCE contenu dans la configuration
    * générale du SAE.<br>
    * <br>
    * Le propriété est sae.dfce.cheminFichierConfig
    * 
    * @return fichier de configuration de DFCE
    */
   public final FileSystemResource loadDFCEConfigResource() {

      FileSystemResource dfceResource = new FileSystemResource(saeProperties
            .getProperty(DFCE_CONFIG));

      return dfceResource;
   }

}
